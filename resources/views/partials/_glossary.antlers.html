<div class="w-full font-IBMPlex" id="glossary-container">
  
  <!-- Header Section -->
  <div class="mb-8">
    <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 mb-6">
      <div>
        <h1 class="text-2xl font-medium text-amp-gray-900 font-Gellix">Event Glossary</h1>
        <p class="text-amp-gray-600 mt-1">Discover all available events and their properties</p>
      </div>
      <div id="stats" class="flex items-center gap-4 text-sm text-amp-gray-500" style="display: none;">
        <span id="event-count" class="px-3 py-1 bg-amp-gray-50 rounded-full"></span>
        <span id="filtered-count" style="display: none;" class="px-3 py-1 bg-amp-blue-50 text-amp-blue-700 rounded-full"></span>
      </div>
    </div>
    
    <!-- Enhanced Search -->
    <div class="max-w-lg">
      <div class="relative">
        <div class="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none">
          <svg class="h-5 w-5 text-amp-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
          </svg>
        </div>
        <input 
          id="search-input"
          type="text" 
          placeholder="Search events..." 
          class="search-input block w-full pl-12 pr-12 py-3 border border-amp-gray-200 rounded-lg bg-white text-amp-gray-900 placeholder-amp-gray-500 focus:outline-none focus:ring-2 focus:ring-amp-blue-500 focus:border-amp-blue-500 transition-colors"
        >
        <div id="clear-btn" class="absolute inset-y-0 right-0 pr-4 flex items-center" style="display: none;">
          <button class="text-amp-gray-400 hover:text-amp-gray-600 transition-colors p-1 rounded">
            <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
            </svg>
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Loading State -->
  <div id="loading" class="flex flex-col items-center justify-center py-16">
    <div class="animate-spin rounded-full h-8 w-8 border-2 border-amp-gray-200 border-t-amp-blue-500"></div>
    <span class="mt-3 text-amp-gray-600 loading-text">Loading events...</span>
  </div>

  <!-- Content will be populated by JavaScript -->
  <div id="glossary-content" class="space-y-4" style="display: none;"></div>
  
  <!-- Empty State -->
  <div id="empty-state" class="text-center py-16" style="display: none;">
    <div class="w-16 h-16 mx-auto mb-4 rounded-full bg-amp-gray-100 flex items-center justify-center">
      <svg class="w-8 h-8 text-amp-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
      </svg>
    </div>
    <h3 class="text-lg font-medium text-amp-gray-900 mb-2">No events found</h3>
    <p class="text-amp-gray-600">Try adjusting your search terms</p>
  </div>
   
  <!-- Error State -->
  <div id="error" class="text-center py-16" style="display: none;">
    <div class="w-16 h-16 mx-auto mb-4 rounded-full bg-error-red-light flex items-center justify-center">
      <svg class="w-8 h-8 text-error-red" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"></path>
      </svg>
    </div>
    <h3 class="text-lg font-medium text-amp-gray-900 mb-2">Failed to load glossary</h3>
    <p class="text-amp-gray-600">Please try refreshing the page</p>
  </div>
</div>

<style>
/* Event Card Styles */
.event-card {
  transition: all 0.2s ease-in-out;
  border: 1px solid #DEDFE2;
}

.event-card:hover {
  border-color: #1e61f0;
  box-shadow: 0 4px 12px rgba(30, 97, 240, 0.08);
  transform: translateY(-1px);
}

.event-card.expanded {
  border-color: #1e61f0;
  box-shadow: 0 8px 24px rgba(30, 97, 240, 0.12);
}

/* Platform Badge Animations */
.platform-badge {
  transition: all 0.15s ease;
}

.platform-badge:hover {
  transform: scale(1.05);
}

/* Properties Table Animations */
.properties-content {
  transition: all 0.3s ease-in-out;
  max-height: 0;
  overflow: hidden;
  opacity: 0;
  margin: 0;
  padding: 0;
  border: none;
}

.properties-content.expanded {
  max-height: 9999px;
  opacity: 1;
  margin-top: 1.5rem;
  padding: 1.5rem;
  border: 1px solid #DEDFE2;
  border-radius: 0.75rem;
  background-color: #FAFBFC;
}

/* Button Hover Effects */
.properties-btn {
  transition: transform 0.1s ease;
}

.properties-btn:hover {
  transform: translateX(2px);
}

/* Property Row Hover */
.property-row {
  transition: background-color 0.15s ease;
}

.property-row:hover {
  background-color: #f8fafc;
}

/* Search Focus Ring */
.search-input:focus {
  box-shadow: 0 0 0 3px rgba(30, 97, 240, 0.1);
}

/* Loading Animation */
@keyframes pulse-blue {
  0%, 100% { opacity: 1; }
  50% { opacity: 0.5; }
}

.loading-text {
  animation: pulse-blue 1.5s ease-in-out infinite;
}

/* Tab System Styles */
.tab-button {
  transition: all 0.2s ease;
  border-bottom: 2px solid transparent;
}

.tab-button.active {
  border-bottom-color: #1e61f0;
  color: #1e61f0;
  background-color: rgba(30, 97, 240, 0.05);
}

.tab-panel {
  display: none;
  animation: fadeIn 0.3s ease-in-out;
}

.tab-panel.active {
  display: block;
}

@keyframes fadeIn {
  from { opacity: 0; transform: translateY(10px); }
  to { opacity: 1; transform: translateY(0); }
}

/* Responsive Grid */
@media (min-width: 1024px) {
  .event-grid {
    display: grid;
    grid-template-columns: 280px 1fr 2fr;
    gap: 1.5rem;
    align-items: center;
  }
}

/* Mobile Optimizations */
@media (max-width: 1023px) {
  .event-card {
    padding: 1rem;
  }
  
  .platform-badges {
    margin-top: 0.5rem;
  }
}

/* Edit Link Hover Styles */
.edit-link {
  opacity: 0;
  visibility: hidden;
  transition: all 0.2s ease;
  position: absolute;
  z-index: 10;
}

.event-card:hover .edit-link {
  opacity: 1;
  visibility: visible;
}

.property-row:hover .edit-link {
  opacity: 1;
  visibility: visible;
}

/* Container positioning for floating edit links */
.edit-container {
  position: relative;
}

.edit-link-event {
  position: absolute;
  top: 0;
  right: 0;
  background: rgba(255, 255, 255, 0.95);
  backdrop-filter: blur(4px);
  border: 1px solid #DEDFE2;
  border-radius: 6px;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
}

.edit-link-property {
  position: absolute;
  top: 0;
  right: 0;
  background: rgba(255, 255, 255, 0.95);
  backdrop-filter: blur(4px);
  border: 1px solid #DEDFE2;
  border-radius: 4px;
  box-shadow: 0 1px 4px rgba(0, 0, 0, 0.1);
}
</style>

<script>
class GlossaryRenderer {
  constructor() {
    this.data = null;
    this.filteredEvents = [];
    this.isLocal = {{ config:app:env == "local" ? "true" : "false" }};
    this.currentExpandedEvent = null; // Track single expanded event for memory efficiency
    this.searchTimeout = null;
    this.init();
  }

  async init() {
    try {
      await this.loadData();
      this.render();
      this.setupSearch();
      this.hideLoading();
    } catch (error) {
      console.error('Failed to load glossary:', error);
      this.showError();
    }
  }

  async loadData() {
    const response = await fetch('/docs/glossary-data.json');
    if (!response.ok) throw new Error('Failed to fetch data');
    const rawData = await response.json();
    
    // Keep only essential data for rendering, store full property data separately
    this.data = {
      events_count: rawData.events_count,
      properties_count: rawData.properties_count,
      events: rawData.events.map(event => ({
        id: event.id,
        title: event.title,
        description: event.description,
        platform: event.platform || [],
        product_area: event.product_area || [],
        total_count: (event.core_properties_count || 0) + 
                    (event.product_specific_properties_count || 0) + 
                    (event.event_specific_properties_count || 0)
      }))
    };
    
    // Store full property data separately for lazy loading (keeps memory separate)
    this.propertiesData = new Map();
    rawData.events.forEach(event => {
      this.propertiesData.set(event.id, {
        core_properties: event.core_properties || [],
        core_properties_count: event.core_properties_count || 0,
        product_specific_properties: event.product_specific_properties || [],
        product_specific_properties_count: event.product_specific_properties_count || 0,
        event_specific_properties: event.event_specific_properties || [],
        event_specific_properties_count: event.event_specific_properties_count || 0
      });
    });
    
    this.filteredEvents = this.data.events;
    this.updateStats();
  }

  render() {
    const content = document.getElementById('glossary-content');
    const emptyState = document.getElementById('empty-state');

    if (this.filteredEvents.length === 0) {
      content.style.display = 'none';
      emptyState.style.display = 'block';
      return;
    }

    content.style.display = 'block';
    emptyState.style.display = 'none';
    
    // Render minimal event cards without properties content
    content.innerHTML = this.filteredEvents.map(event => this.renderEvent(event)).join('');
    this.updateStats();
  }

  updateStats() {
    const statsContainer = document.getElementById('stats');
    const eventCount = document.getElementById('event-count');
    const filteredCount = document.getElementById('filtered-count');
    
    if (this.data) {
      statsContainer.style.display = 'flex';
      eventCount.textContent = `${this.data.events.length} events`;
      
      if (this.filteredEvents.length !== this.data.events.length) {
        filteredCount.textContent = `${this.filteredEvents.length} filtered`;
        filteredCount.style.display = 'inline-block';
      } else {
        filteredCount.style.display = 'none';
      }
    }
  }

  renderEvent(event) {
    const platformBadges = event.platform.map(platform => {
      const configs = {
        web: { color: 'bg-mint-100 text-mint-800', icon: '🌐', label: 'Web' },
        ios: { color: 'bg-amp-gray-100 text-amp-gray-800', icon: '📱', label: 'iOS' },
        android: { color: 'bg-amp-light-teal-200 text-amp-dark-teal', icon: '🤖', label: 'Android' }
      };
      const config = configs[platform] || { color: 'bg-amp-blue-100 text-amp-blue-800', icon: '⭐', label: platform };
      
      return `<span class="platform-badge inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium ${config.color}" title="${config.label}">
        <span class="text-xs">${config.icon}</span>
        <span>${config.label}</span>
      </span>`;
    }).join('');

    const productAreaBadges = event.product_area && event.product_area.length > 0 ? event.product_area.map(area => {
      const displayName = area.replace(/&/g, '&amp;').split(' ').map(word => 
        word.charAt(0).toUpperCase() + word.slice(1)
      ).join(' ');
      
      return `<span class="platform-badge inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium bg-amp-light-purple-200 text-amp-light-purple-900" title="Product Area: ${displayName}">
        <span class="text-xs">📦</span>
        <span>${displayName}</span>
      </span>`;
    }).join('') : '';

    const eventEditLink = this.isLocal ? `
      <a href="/cp/collections/glossary_events/entries/${event.id}/edit" 
         target="_blank"
         rel="noopener noreferrer"
         class="edit-link edit-link-event inline-flex items-center gap-1 px-2 py-1 text-xs text-amp-blue-600 hover:text-amp-blue-800 transition-colors"
         title="Edit this event in Statamic CP">
        <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
        </svg>
        Edit
      </a>
    ` : '';

    const propertiesButton = event.total_count > 0 ? `
      <button 
        onclick="glossary.toggleProperties('${event.id}')"
        id="btn-${event.id}"
        class="properties-btn inline-flex items-center gap-2 text-amp-blue-600 text-sm font-medium hover:text-amp-blue-800 focus:outline-none underline-offset-2 hover:underline transition-transform"
      >
        <svg id="icon-${event.id}" class="w-4 h-4 transition-transform duration-200" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
        </svg>
        <span id="btn-text-${event.id}">View Properties (${event.total_count})</span>
      </button>
    ` : `<div class="text-sm text-amp-gray-500 italic flex items-center gap-2">
        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 12H4"></path>
        </svg>
        No properties
      </div>`;

    return `
      <div class="event-card bg-white rounded-xl p-6 border edit-container" data-event-title="${event.title}" id="card-${event.id}">
        ${eventEditLink}
        <div class="event-grid">
          <div class="flex flex-col justify-center space-y-3">
            <div>
              <h3 class="text-lg font-semibold text-amp-gray-900 mb-2">${event.title}</h3>
              <div class="flex flex-wrap gap-2 mb-2">
                ${platformBadges}
                ${productAreaBadges}
              </div>
            </div>
          </div>
          
          <div class="flex lg:justify-center items-center">
            ${propertiesButton}
          </div>
          
          <div class="flex items-center">
            <p class="text-amp-gray-700 leading-relaxed">${event.description}</p>
          </div>
        </div>
        
        <div class="lg:hidden mt-4 pt-4 border-t border-amp-gray-100">
          ${propertiesButton}
        </div>
        
        <!-- Properties container - empty until expanded -->
        <div id="props-${event.id}" class="properties-content bg-amp-gray-50 rounded-xl"></div>
      </div>
    `;
  }

  toggleProperties(eventId) {
    const props = document.getElementById(`props-${eventId}`);
    const btn = document.getElementById(`btn-text-${eventId}`);
    const icon = document.getElementById(`icon-${eventId}`);
    const card = document.getElementById(`card-${eventId}`);
    const isExpanded = props.classList.contains('expanded');
    
    // Close any other expanded event first (memory conservation)
    if (this.currentExpandedEvent && this.currentExpandedEvent !== eventId) {
      this.collapseEvent(this.currentExpandedEvent);
    }
    
    if (isExpanded) {
      this.collapseEvent(eventId);
      this.currentExpandedEvent = null;
    } else {
      this.expandEvent(eventId);
      this.currentExpandedEvent = eventId;
    }
  }

  collapseEvent(eventId) {
    const props = document.getElementById(`props-${eventId}`);
    const btn = document.getElementById(`btn-text-${eventId}`);
    const icon = document.getElementById(`icon-${eventId}`);
    const card = document.getElementById(`card-${eventId}`);
    const event = this.data.events.find(e => e.id === eventId);

    props.classList.remove('expanded');
    card.classList.remove('expanded');
    btn.textContent = `View Properties (${event.total_count})`;
    icon.style.transform = 'rotate(0deg)';
    
    // Clear DOM content after animation to free memory
    setTimeout(() => {
      if (!props.classList.contains('expanded')) {
        props.innerHTML = '';
      }
    }, 300);
  }

  expandEvent(eventId) {
    const props = document.getElementById(`props-${eventId}`);
    const btn = document.getElementById(`btn-text-${eventId}`);
    const icon = document.getElementById(`icon-${eventId}`);
    const card = document.getElementById(`card-${eventId}`);

    // Load properties data from separate storage
    const eventData = this.propertiesData.get(eventId);
    if (eventData) {
      props.innerHTML = this.renderSeparatedProperties(eventId, eventData);
    }

    props.classList.add('expanded');
    card.classList.add('expanded');
    btn.textContent = 'Hide Properties';
    icon.style.transform = 'rotate(90deg)';
  }

  renderSeparatedProperties(eventId, eventData) {
    const hasCoreProperties = eventData.core_properties && eventData.core_properties.length > 0;
    const hasProductProperties = eventData.product_specific_properties && eventData.product_specific_properties.length > 0;
    const hasEventProperties = eventData.event_specific_properties && eventData.event_specific_properties.length > 0;
    
    if (!hasCoreProperties && !hasProductProperties && !hasEventProperties) {
      return '<p class="text-amp-gray-500 italic">No properties available for this event.</p>';
    }
    
    const tabContainerId = `tabs-${eventId}`;
    let defaultActiveTab = '';
    if (hasEventProperties) defaultActiveTab = 'event';
    else if (hasProductProperties) defaultActiveTab = 'product';
    else if (hasCoreProperties) defaultActiveTab = 'core';
    
    let output = `
      <div class="property-tabs" id="${tabContainerId}">
        <div class="mb-4">
          <h4 class="text-lg font-medium text-amp-gray-900 mb-2">Event Properties</h4>
          <p class="text-sm text-amp-gray-600">Properties are organized by their scope and application:</p>
        </div>
        
        <!-- Tab Navigation -->
        <div class="flex border-b border-amp-gray-200 mb-6">
    `;
    
    // Event-Specific Properties Tab
    if (hasEventProperties) {
      output += `
        <button 
          class="tab-button flex items-center gap-2 px-4 py-3 text-sm font-medium border-b-2 border-transparent hover:text-amp-blue-600 hover:border-amp-blue-300 transition-colors ${defaultActiveTab === 'event' ? 'active' : ''}"
          data-tab="event"
          data-container="${tabContainerId}"
          onclick="glossary.switchTab('${tabContainerId}', 'event')"
        >
          <div class="w-4 h-4 rounded-full bg-amp-light-purple-400 flex items-center justify-center">
            <svg class="w-2 h-2 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path>
            </svg>
          </div>
          <span>Event-Specific</span>
          <span class="px-2 py-1 text-xs bg-amp-light-purple-900 text-amp-light-purple-300 rounded-full">${eventData.event_specific_properties.length}</span>
        </button>
      `;
    }
    
    // Product-Specific Properties Tab
    if (hasProductProperties) {
      output += `
        <button 
          class="tab-button flex items-center gap-2 px-4 py-3 text-sm font-medium border-b-2 border-transparent hover:text-amp-blue-600 hover:border-amp-blue-300 transition-colors ${defaultActiveTab === 'product' ? 'active' : ''}"
          data-tab="product"
          data-container="${tabContainerId}"
          onclick="glossary.switchTab('${tabContainerId}', 'product')"
        >
          <div class="w-4 h-4 rounded-full bg-amp-blue-600 flex items-center justify-center">
            <svg class="w-2 h-2 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"></path>
            </svg>
          </div>
          <span>Product-Specific</span>
          <span class="px-2 py-1 text-xs bg-amp-blue-100 text-amp-blue-700 rounded-full">${eventData.product_specific_properties.length}</span>
        </button>
      `;
    }
    
    // Core Properties Tab
    if (hasCoreProperties) {
      output += `
        <button 
          class="tab-button flex items-center gap-2 px-4 py-3 text-sm font-medium border-b-2 border-transparent hover:text-amp-blue-600 hover:border-amp-blue-300 transition-colors ${defaultActiveTab === 'core' ? 'active' : ''}"
          data-tab="core"
          data-container="${tabContainerId}"
          onclick="glossary.switchTab('${tabContainerId}', 'core')"
        >
          <div class="w-4 h-4 rounded-full bg-amp-gray-600 flex items-center justify-center">
            <svg class="w-2 h-2 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M9 12l2 2 4-4"></path>
            </svg>
          </div>
          <span>Core Properties</span>
          <span class="px-2 py-1 text-xs bg-amp-gray-100 text-amp-gray-700 rounded-full">${eventData.core_properties.length}</span>
        </button>
      `;
    }
    
    output += `
        </div>
        
        <!-- Tab Content -->
        <div class="tab-content">
    `;
    
    // Event-Specific Properties Content
    if (hasEventProperties) {
      output += `
        <div 
          class="tab-panel ${defaultActiveTab === 'event' ? 'active' : ''}" 
          data-tab="event"
          data-container="${tabContainerId}"
        >
          <div class="mb-4">
            <p class="text-sm text-amp-gray-600">Properties unique to this specific event:</p>
          </div>
          ${this.renderProperties(eventData.event_specific_properties)}
        </div>
      `;
    }
    
    // Product-Specific Properties Content
    if (hasProductProperties) {
      output += `
        <div 
          class="tab-panel ${defaultActiveTab === 'product' ? 'active' : ''}" 
          data-tab="product"
          data-container="${tabContainerId}"
        >
          <div class="mb-4">
            <p class="text-sm text-amp-gray-600">Properties that apply to this product area:</p>
          </div>
          ${this.renderProperties(eventData.product_specific_properties)}
        </div>
      `;
    }
    
    // Core Properties Content
    if (hasCoreProperties) {
      output += `
        <div 
          class="tab-panel ${defaultActiveTab === 'core' ? 'active' : ''}" 
          data-tab="core"
          data-container="${tabContainerId}"
        >
          <div class="mb-4">
            <p class="text-sm text-amp-gray-600">Standard properties available across all events:</p>
          </div>
          ${this.renderProperties(eventData.core_properties)}
        </div>
      `;
    }
    
    output += `
        </div>
      </div>
    `;
    
    return output;
  }

  renderProperties(properties) {
    return `
      <div class="space-y-3">
        ${properties.map(prop => `
          <div class="property-row bg-white rounded-lg p-4 border border-amp-gray-100 edit-container">
            ${this.isLocal ? `
              <a href="/cp/collections/glossary_properties/entries/${prop.id}/edit" 
                 target="_blank"
                 rel="noopener noreferrer"
                 class="edit-link edit-link-property inline-flex items-center gap-1 px-2 py-1 text-xs text-amp-blue-600 hover:text-amp-blue-800 transition-colors"
                 title="Edit this property">
                <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
                </svg>
                Edit
              </a>
            ` : ''}
            <div class="flex flex-col lg:flex-row lg:items-start gap-3">
              <!-- Property Name -->
              <div class="lg:w-1/3">
                <h5 class="text-sm font-semibold text-amp-gray-900">${prop.title}</h5>
                ${prop.data_type && prop.data_type.length > 0 ? `
                  <div class="flex flex-wrap gap-1 mt-2">
                    ${prop.data_type.map(type => 
                      `<span class="inline-flex items-center px-2 py-1 text-xs bg-amp-blue-50 text-amp-blue-700 rounded-md font-medium">${type}</span>`
                    ).join('')}
                  </div>
                ` : ''}
              </div>
              
              <!-- Property Description -->
              <div class="lg:w-2/3">
                <p class="text-sm text-amp-gray-700 leading-relaxed">${prop.description}</p>
              </div>
            </div>
          </div>
        `).join('')}
      </div>
    `;
  }

  switchTab(containerId, tabName) {
    const container = document.getElementById(containerId);
    if (!container) return;
    
    // Remove active class from all tabs and panels in this container
    const allButtons = container.querySelectorAll('.tab-button');
    const allPanels = container.querySelectorAll('.tab-panel');
    
    allButtons.forEach(btn => btn.classList.remove('active'));
    allPanels.forEach(panel => panel.classList.remove('active'));
    
    // Add active class to selected tab and panel
    const activeButton = container.querySelector(`[data-tab="${tabName}"]`);
    const activePanel = container.querySelector(`[data-tab="${tabName}"].tab-panel`);
    
    if (activeButton) activeButton.classList.add('active');
    if (activePanel) activePanel.classList.add('active');
  }

  setupSearch() {
    const input = document.getElementById('search-input');
    const clearBtn = document.getElementById('clear-btn');
    
    input.addEventListener('input', (e) => {
      const value = e.target.value.toLowerCase();
      clearBtn.style.display = value ? 'flex' : 'none';
      
      // Clear previous timeout
      if (this.searchTimeout) clearTimeout(this.searchTimeout);
      
      // Debounce search and close any expanded properties
      this.searchTimeout = setTimeout(() => {
        if (this.currentExpandedEvent) {
          this.collapseEvent(this.currentExpandedEvent);
          this.currentExpandedEvent = null;
        }
        
        this.filteredEvents = value 
          ? this.data.events.filter(event => event.title.toLowerCase().includes(value))
          : this.data.events;
        this.render();
      }, 300);
    });
    
    clearBtn.addEventListener('click', () => {
      input.value = '';
      clearBtn.style.display = 'none';
      this.filteredEvents = this.data.events;
      this.render();
    });
  }

  hideLoading() {
    document.getElementById('loading').style.display = 'none';
    document.getElementById('glossary-content').style.display = 'block';
  }

  showError() {
    document.getElementById('loading').style.display = 'none';
    document.getElementById('error').style.display = 'block';
  }
}

// Initialize when DOM is ready
document.addEventListener('DOMContentLoaded', () => {
  window.glossary = new GlossaryRenderer();
});
</script>