{{# 
  Modern Navigation using Lit Web Component
  - Clean separation of concerns
  - Maintainable TypeScript component
  - Works with Statamic nav structures
#}}

{{if nav_title =="source-catalog" || nav_title=="destination-catalog"}}
  {{# Catalog navigation - flat list of integrations #}}
  <nav-tree
    type="catalog"
    current-uri="{{ current_uri }}"
    id="nav-catalog-{{ nav_title }}"
  ></nav-tree>
  
  <script>
    // Hydrate catalog navigation
    (function() {
      const data = [
        {{ collection :from="nav_title" as="integrations" }}
          {{ integrations }}
            {
              "id": "{{ id }}",
              "title": {{ title | sanitize | to_json }},
              "url": "{{ url }}",
              "is_current": {{ if current_uri == url }}true{{ else }}false{{ /if }}
            }{{ unless last }},{{ /unless }}
          {{ /integrations }}
        {{ /collection }}
      ];
      
      const navEl = document.getElementById('nav-catalog-{{ nav_title }}');
      if (navEl) {
        navEl.items = data;
      }
    })();
  </script>
{{else}}
  {{# Standard navigation tree #}}
  <nav-tree 
    current-uri="{{ current_uri }}"
    id="nav-{{ nav_title }}"
  ></nav-tree>
  
  <script>
    // Hydrate standard navigation
    (function() {
      const navData = [
        {{ nav :handle="nav_title" }}
          {
            "id": "{{ id }}",
            "title": {{ title | sanitize | to_json }},
            {{ if url }}"url": "{{ url }}",{{ /if }}
            {{ if entry }}"entry": "{{ entry }}",{{ /if }}
            {{ if is_current }}"is_current": true,{{ /if }}
            {{ if is_parent }}"is_parent": true,{{ /if }}
            {{ if children }}
              "children": [
                {{ children }}
                  {
                    "id": "{{ id }}",
                    "title": {{ title | sanitize | to_json }},
                    {{ if url }}"url": "{{ url }}",{{ /if }}
                    {{ if entry }}"entry": "{{ entry }}",{{ /if }}
                    {{ if is_current }}"is_current": true,{{ /if }}
                    {{ if is_parent }}"is_parent": true,{{ /if }}
                    {{ if children }}
                      "children": [
                        {{ children }}
                          {
                            "id": "{{ id }}",
                            "title": {{ title | sanitize | to_json }},
                            {{ if url }}"url": "{{ url }}",{{ /if }}
                            {{ if entry }}"entry": "{{ entry }}",{{ /if }}
                            {{ if is_current }}"is_current": true,{{ /if }}
                            {{ if is_parent }}"is_parent": true,{{ /if }}
                            {{ if children }}
                              "children": [
                                {{ children }}
                                  {
                                    "id": "{{ id }}",
                                    "title": {{ title | sanitize | to_json }},
                                    {{ if url }}"url": "{{ url }}",{{ /if }}
                                    {{ if entry }}"entry": "{{ entry }}",{{ /if }}
                                    {{ if is_current }}"is_current": true,{{ /if }}
                                    {{ if is_parent }}"is_parent": true,{{ /if }}
                                    "x": null
                                  }{{ unless last }},{{ /unless }}
                                {{ /children }}
                              ],
                            {{ /if }}
                            "x": null
                          }{{ unless last }},{{ /unless }}
                        {{ /children }}
                      ],
                    {{ /if }}
                    "x": null
                  }{{ unless last }},{{ /unless }}
                {{ /children }}
              ],
            {{ /if }}
            "x": null
          }{{ unless last }},{{ /unless }}
        {{ /nav }}
      ];
      
      const navEl = document.getElementById('nav-{{ nav_title }}');
      if (navEl && navData) {
        navEl.items = navData;
      }
    })();
  </script>
{{/if}}
