{{#
  Side Navigation - Lit Web Components Version
  
  Uses <amp-side-nav>, <amp-nav-item>, and <amp-catalog-nav> custom elements
  for a clean, component-based navigation structure.
#}}

{{if nav_title == "source-catalog" || nav_title == "destination-catalog"}}
  {{# Catalog navigation - flat list with back link #}}
  <amp-catalog-nav back-url="/docs/data" back-label="Back to Data" current-uri="{{ current_uri }}">
    {{collection :from="nav_title" as="integrations"}}
      {{integrations}}
        <a href="{{url}}" class="{{if current_uri == url }}active{{/if}}">{{title}}</a>
      {{/integrations}}
    {{/collection}}
  </amp-catalog-nav>

{{else}}
  {{# Standard multi-level navigation #}}
  <amp-side-nav current-uri="{{ current_uri }}" nav-title="{{ nav_title }}">
    {{ nav :handle="nav_title" }}
      {{# Level 1 items #}}
      {{ if url && children }}
        {{# Has URL and children - expandable link #}}
        <amp-nav-item 
          title="{{ title }}" 
          url="{{ url }}" 
          slug="{{ title | slugify }}"
          has-children
          level="1"
          {{ if is_current }}is-current{{ /if }}>
          {{ children }}
            {{# Level 2 items #}}
            {{ if url }}
              {{ if children }}
                {{# Level 2 with children #}}
                <amp-nav-item 
                  title="{{ title }}" 
                  url="{{ url }}" 
                  slug="{{ title | slugify }}"
                  parent-slug="{{ parent:title | slugify }}"
                  has-children
                  level="2"
                  {{ if is_current }}is-current{{ /if }}>
                  {{ children }}
                    {{# Level 3 items #}}
                    <amp-nav-item 
                      title="{{ title }}" 
                      url="{{ url }}" 
                      slug="{{ title | slugify }}"
                      parent-slug="{{ parent:title | slugify }}"
                      {{ if icon }}icon="{{ icon }}"{{ /if }}
                      level="3"
                      {{ if is_current }}is-current{{ /if }}>
                    </amp-nav-item>
                  {{ /children }}
                </amp-nav-item>
              {{ else }}
                {{# Level 2 link only #}}
                <amp-nav-item 
                  title="{{ title }}" 
                  url="{{ url }}" 
                  slug="{{ title | slugify }}"
                  parent-slug="{{ parent:title | slugify }}"
                  level="2"
                  {{ if is_current }}is-current{{ /if }}>
                </amp-nav-item>
              {{ /if }}
            {{ else }}
              {{ if children }}
                {{# Level 2 button (no URL, has children) #}}
                <amp-nav-item 
                  title="{{ title }}" 
                  slug="{{ title | slugify }}"
                  parent-slug="{{ parent:title | slugify }}"
                  has-children
                  level="2">
                  {{ children }}
                    {{# Level 3 items #}}
                    <amp-nav-item 
                      title="{{ title }}" 
                      url="{{ url }}" 
                      slug="{{ title | slugify }}"
                      parent-slug="{{ parent:title | slugify }}"
                      {{ if icon }}icon="{{ icon }}"{{ /if }}
                      level="3"
                      {{ if is_current }}is-current{{ /if }}>
                    </amp-nav-item>
                  {{ /children }}
                </amp-nav-item>
              {{ /if }}
            {{ /if }}
          {{ /children }}
        </amp-nav-item>

      {{ elseif url }}
        {{# URL only - plain link #}}
        <amp-nav-item 
          title="{{ title }}" 
          url="{{ url }}" 
          slug="{{ title | slugify }}"
          level="1"
          {{ if is_current }}is-current{{ /if }}>
        </amp-nav-item>

      {{ elseif children }}
        {{# Button only - no URL but has children #}}
        <amp-nav-item 
          title="{{ title }}" 
          slug="{{ title | slugify }}"
          has-children
          level="1">
          {{ children }}
            {{# Level 2 items #}}
            {{ if url }}
              {{ if children }}
                {{# Level 2 with children #}}
                <amp-nav-item 
                  title="{{ title }}" 
                  url="{{ url }}" 
                  slug="{{ title | slugify }}"
                  parent-slug="{{ parent:title | slugify }}"
                  has-children
                  level="2"
                  {{ if is_current }}is-current{{ /if }}>
                  {{ children }}
                    {{# Level 3 items #}}
                    <amp-nav-item 
                      title="{{ title }}" 
                      url="{{ url }}" 
                      slug="{{ title | slugify }}"
                      parent-slug="{{ parent:title | slugify }}"
                      {{ if icon }}icon="{{ icon }}"{{ /if }}
                      level="3"
                      {{ if is_current }}is-current{{ /if }}>
                    </amp-nav-item>
                  {{ /children }}
                </amp-nav-item>
              {{ else }}
                {{# Level 2 link only #}}
                <amp-nav-item 
                  title="{{ title }}" 
                  url="{{ url }}" 
                  slug="{{ title | slugify }}"
                  parent-slug="{{ parent:title | slugify }}"
                  level="2"
                  {{ if is_current }}is-current{{ /if }}>
                </amp-nav-item>
              {{ /if }}
            {{ else }}
              {{ if children }}
                {{# Level 2 button (no URL, has children) #}}
                <amp-nav-item 
                  title="{{ title }}" 
                  slug="{{ title | slugify }}"
                  parent-slug="{{ parent:title | slugify }}"
                  has-children
                  level="2">
                  {{ children }}
                    {{# Level 3 items #}}
                    <amp-nav-item 
                      title="{{ title }}" 
                      url="{{ url }}" 
                      slug="{{ title | slugify }}"
                      parent-slug="{{ parent:title | slugify }}"
                      {{ if icon }}icon="{{ icon }}"{{ /if }}
                      level="3"
                      {{ if is_current }}is-current{{ /if }}>
                    </amp-nav-item>
                  {{ /children }}
                </amp-nav-item>
              {{ /if }}
            {{ /if }}
          {{ /children }}
        </amp-nav-item>
      {{ /if }}
    {{ /nav }}
  </amp-side-nav>
{{/if}}
