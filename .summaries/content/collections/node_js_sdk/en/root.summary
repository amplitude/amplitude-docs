# Amplitude Node.js SDK

## Overview

The Amplitude Node.js SDK is a server-side analytics tracking solution that enables developers to track user behavior and events in Node.js applications. The SDK is available in two versions: the latest SDK (`@amplitude/analytics-node`) and a maintenance version (`@amplitude/node`). The SDK provides robust event tracking capabilities with features like event batching, retry handling, user identification, and group tracking.

Key features include:
- Event tracking with customizable properties
- User identification and user property management
- Group tracking for analyzing user behavior by groups
- Revenue tracking
- Event batching and flush control
- Plugin architecture for customization
- EU data residency support
- TypeScript support with type definitions

The SDK also offers the Ampli Wrapper, a strongly-typed API generated from Amplitude Data tracking plans that provides type-safe event tracking with autocompletion and schema enforcement for both JavaScript and TypeScript applications.

## Product Relationships and Features

### Core SDK Components

1. **Base Node.js SDK (`@amplitude/analytics-node`)**
   - Main implementation for server-side event tracking
   - Provides event batching and retry handling
   - Configurable batch size and upload intervals
   - Plugin architecture for customization

2. **Maintenance SDK (`@amplitude/node`)**
   - Legacy version being phased out
   - Different API structure compared to the latest SDK
   - Uses middleware instead of plugins

3. **Ampli Wrapper**
   - Code-generated from Amplitude Data tracking plans
   - Provides strongly-typed APIs for event tracking
   - Available for both JavaScript and TypeScript
   - Enforces schema validation for events

### Feature Breakdown

#### Event Tracking
- `track()` method for sending events (latest SDK)
- `logEvent()` method in the maintenance SDK
- Support for custom event properties
- Event batching with configurable batch size and upload intervals

#### User Identification
- `identify()` method for setting user properties
- User property operations: set, setOnce, add, append, prepend, etc.
- Anonymous user tracking with device IDs

#### Group Tracking
- `setGroup()` method for assigning users to groups
- Group property management with `groupIdentify()`

#### Revenue Tracking
- `revenue()` method for tracking revenue events
- Support for product ID, quantity, price, and revenue type

#### Plugins and Customization
- Plugin architecture for extending functionality
- Built-in plugins for event enrichment, destination control, etc.
- Custom plugin creation for specialized needs

#### Data Management
- Event buffering with configurable limits
- Manual and automatic event flushing
- Opt-out functionality for privacy compliance

## Key Nomenclature and Definitions

- **Event**: An action that a user performs in your application
- **User Properties**: Attributes associated with a user that persist across sessions
- **Device ID**: An identifier for anonymous users before they are identified
- **User ID**: A unique identifier for a known user
- **Group**: A collection of users that can be analyzed together
- **Tracking Plan**: A schema that defines the expected structure of events and properties
- **Ampli Wrapper**: A code-generated SDK based on a tracking plan that provides type-safe event tracking
- **Plugin**: A modular component that can modify or process events in the SDK pipeline
- **Middleware**: The legacy term for plugins in the maintenance SDK
- **Flush**: The process of sending batched events to Amplitude servers
- **Batch Size**: The number of events to collect before automatically sending to Amplitude

## Product Ecosystem Integration

The Node.js SDK is part of Amplitude's broader analytics platform ecosystem:

1. **Integration with Amplitude Analytics**
   - Events tracked through the SDK appear in Amplitude Analytics dashboards
   - Supports user property and event property analysis
   - Works with Amplitude's cohort analysis and segmentation features

2. **Compatibility with Amplitude Data**
   - The Ampli Wrapper is generated from Amplitude Data tracking plans
   - Ensures consistency between planned and implemented tracking

3. **Cross-Platform Tracking**
   - Can be used alongside client-side SDKs (Web, Mobile) for full-stack tracking
   - Events from server and client can be correlated for the same user

4. **Backend Services Integration**
   - Designed for server-side applications, microservices, and APIs
   - Can be integrated with other backend systems for comprehensive analytics

## API Endpoints and CLI Commands

### SDK API Methods

#### Latest SDK (`@amplitude/analytics-node`)
```javascript
// Initialization
const amplitude = new Amplitude('API_KEY', {
  serverUrl: 'https://api.amplitude.com',
  flushQueueSize: 200,
  flushIntervalMillis: 10000
});

// Event tracking
amplitude.track({
  event_type: 'Button Clicked',
  user_id: 'user@example.com',
  event_properties: { buttonColor: 'blue' }
});

// User identification
amplitude.identify({
  user_id: 'user@example.com',
  user_properties: {
    $set: { name: 'John Doe' },
    $add: { visits: 1 }
  }
});

// Group assignment
amplitude.setGroup('orgId', 'org-123');

// Manual flush
amplitude.flush();
```

#### Ampli Wrapper
```javascript
// Initialization
ampli.load({ client: { apiKey: 'API_KEY' } });

// Strongly-typed event tracking
ampli.track('Button Clicked', {
  buttonColor: 'blue'
});

// User identification
ampli.identify('user-id', {
  userProp1: 'value1'
});

// Group assignment
ampli.setGroup('orgId', 'org-123');

// Manual flush
ampli.flush();
```

### Ampli CLI Commands

- `ampli pull`: Pulls the latest tracking plan from Amplitude Data and generates the Ampli Wrapper
- `ampli status`: Shows the status of the local Ampli Wrapper compared to the remote tracking plan

### HTTP Endpoints Used

The SDK communicates with Amplitude's servers using:
- Standard API endpoint: `https://api.amplitude.com`
- EU data residency endpoint: `https://api.eu.amplitude.com`
- HTTP V2 API for event ingestion