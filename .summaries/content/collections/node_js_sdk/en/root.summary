# Amplitude Node.js SDK

## Overview

The Amplitude Node.js SDK is a server-side analytics tracking solution that enables developers to track user behavior and events in Node.js applications. The SDK is written in TypeScript and provides robust features for event tracking, user identification, and data management. It offers both a standard SDK implementation and a strongly-typed Ampli Wrapper that can be generated from a tracking plan in Amplitude Data.

Key features include:
- Event batching and reliable delivery with retry handling
- User and group identification
- Revenue tracking
- Plugin architecture for customization
- EU data residency support
- TypeScript support with built-in type definitions
- Strongly-typed event tracking via the Ampli Wrapper

## Product Components

The Node.js SDK ecosystem consists of two main components:

1. **Core Node.js SDK** (`@amplitude/analytics-node`) - The main SDK package that provides the core functionality for tracking events, managing user properties, and configuring the SDK.

2. **Ampli Wrapper** - A generated, strongly-typed API layer that sits on top of the core SDK and provides type-safe event tracking based on a tracking plan defined in Amplitude Data.

## Key Nomenclature and Definitions

- **Event Tracking**: The process of recording user actions and behaviors as events in Amplitude.
- **User Properties**: Attributes associated with a user that provide context for analysis.
- **Group Identification**: Associating users with organizational groups for group-level analytics.
- **Tracking Plan**: A schema that defines the expected events and their properties for an application.
- **Plugins**: Modular components that can be added to the SDK to customize its behavior.
- **Middleware**: (In the maintenance SDK) Functions that can intercept and modify events before they are sent.
- **Flush**: The process of immediately sending batched events to Amplitude servers.
- **Batch Processing**: Grouping multiple events together to send them in a single network request.

## SDK Implementation

### Installation

```bash
# For the core SDK
npm install @amplitude/analytics-node

# For the Ampli Wrapper CLI
npm install -g @amplitude/ampli
```

### Core SDK Initialization

```javascript
import { init } from '@amplitude/analytics-node';

init('API_KEY', {
  // Optional configuration
  serverUrl: 'https://api.amplitude.com',
  flushQueueSize: 200,
  flushIntervalMillis: 10000,
  logLevel: 0
});
```

### Event Tracking

```javascript
import { track } from '@amplitude/analytics-node';

track('Event Name', {
  property1: 'value1',
  property2: 'value2'
}, {
  user_id: 'user@example.com'
});
```

### User Identification

```javascript
import { identify, setUserId } from '@amplitude/analytics-node';

// Set user ID
setUserId('user@example.com');

// Set user properties
identify({
  userProperties: {
    $set: {
      name: 'John Doe',
      plan: 'premium'
    },
    $add: {
      loginCount: 1
    }
  }
});
```

### Group Identification

```javascript
import { groupIdentify, setGroup } from '@amplitude/analytics-node';

// Assign user to groups
setGroup('orgId', ['org_1', 'org_2']);

// Set group properties
groupIdentify('orgId', 'org_1', {
  $set: {
    name: 'Amplitude',
    industry: 'Analytics'
  }
});
```

### Flushing Events

```javascript
import { flush } from '@amplitude/analytics-node';

// Manually flush events
await flush();
```

## Ampli Wrapper Implementation

The Ampli Wrapper provides a strongly-typed interface for tracking events based on a tracking plan.

### Ampli CLI Commands

```bash
# Pull tracking plan from Amplitude
ampli pull

# Check implementation status
ampli status
```

### Ampli Initialization

```javascript
import { ampli } from './ampli';

ampli.load({
  client: {
    apiKey: 'API_KEY',
    configuration: {
      // Optional configuration
    }
  }
});
```

### Tracking Events with Ampli

```javascript
// Track a predefined event with type checking
ampli.songPlayed({
  songId: 'song-123',
  songName: 'Bohemian Rhapsody',
  artist: 'Queen'
});

// Identify a user with Ampli
ampli.identify('user-123', {
  userProperties: {
    $set: {
      plan: 'premium'
    }
  }
});
```

## Migration from Maintenance SDK

The latest Node.js SDK (`@amplitude/analytics-node`) replaces the maintenance SDK (`@amplitude/node`) with several key differences:

1. **Initialization**: The new SDK uses `init()` instead of creating an instance of `Amplitude`.
2. **API Methods**: Methods like `logEvent()` are replaced with `track()`.
3. **Architecture**: The new SDK uses a plugin architecture instead of middleware.
4. **TypeScript Support**: The new SDK has built-in type definitions.

API Method Mapping:
- `amplitude.logEvent()` → `track()`
- `amplitude.setUserId()` → `setUserId()`
- `amplitude.setUserProperties()` → `identify()`
- `amplitude.setGroup()` → `setGroup()`
- `amplitude.groupIdentify()` → `groupIdentify()`
- `amplitude.logRevenue()` → `revenue()`
- `amplitude.flush()` → `flush()`

## Integration with Amplitude Ecosystem

The Node.js SDK integrates with other Amplitude products:

1. **Amplitude Data**: The Ampli Wrapper is generated based on tracking plans defined in Amplitude Data.
2. **Amplitude Analytics**: All tracked events are sent to Amplitude Analytics for analysis.
3. **EU Data Residency**: The SDK supports sending data to EU servers for compliance with data regulations.

## API Endpoints

The SDK communicates with the following Amplitude endpoints:

- Standard API: `https://api.amplitude.com`
- EU Data Residency: `https://api.eu.amplitude.com`
- HTTP V2 API for event ingestion

## Configuration Options

Key configuration options include:

- `flushQueueSize`: Maximum number of events to batch before sending (default: 200)
- `flushIntervalMillis`: Interval for automatically sending batched events (default: 10000ms)
- `serverUrl`: API endpoint for sending events
- `serverZone`: Set to 'EU' for EU data residency
- `logLevel`: Controls the verbosity of SDK logs
- `minIdLength`: Minimum length for user and device IDs
- `transportProvider`: Custom transport implementation for sending events

The Node.js SDK provides a reliable and flexible solution for tracking analytics in server-side applications, with options for both simple implementation and strongly-typed tracking based on a predefined schema.