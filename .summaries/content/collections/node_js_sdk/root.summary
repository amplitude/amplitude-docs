# Amplitude Node.js SDK

The Amplitude Node.js SDK is a comprehensive analytics tracking solution for server-side JavaScript and TypeScript applications, providing event tracking, user identification, and data management capabilities that integrate with Amplitude's analytics platform.

## Product Architecture and Relationships

The ecosystem consists of two primary SDK implementations with distinct architectural approaches:

**Legacy SDK (`@amplitude/node`)** operates on a middleware-based architecture in maintenance mode. It processes events through middleware chains using `MiddlewarePayload` objects and implements batch uploading controlled by `maxCachedEvents` and `uploadIntervalInSec` parameters. Event tracking occurs through the `logEvent()` method.

**Current SDK (`@amplitude/analytics-node`)** features a modern plugin architecture as the actively developed solution. It replaces the middleware system with extensible plugins including `EnrichmentPlugin` and `DestinationPlugin` interfaces. Event tracking uses the `track()` method and supports both HTTP V2 API and batch API endpoints through configurable transport providers.

**Ampli Wrapper Layer** enhances both SDKs with strongly-typed APIs generated from Amplitude Data tracking plans. This wrapper provides compile-time type safety, schema validation, and enforces event structure consistency across implementations.

## Core Nomenclature and Definitions

**Primary Tracking Methods:**
- `init()` - SDK initialization requiring API key and configuration objects
- `track()`/`logEvent()` - Core event tracking methods (current vs legacy)
- `identify()` - User property assignment and user identification
- `setGroup()`/`groupIdentify()` - Group membership assignment and group property management
- `flush()` - Forces immediate transmission of queued events

**Configuration Parameters:**
- `flushQueueSize`/`maxCachedEvents` - Defines batch size thresholds for event transmission
- `flushIntervalMillis`/`uploadIntervalInSec` - Controls time-based batching intervals
- `serverZone` - Configures EU data residency compliance
- `minIdLength` - Sets minimum character requirements for user and device identifiers
- `useBatch` - Toggles between HTTP V2 API and batch API endpoints

**Extensibility Architecture:**
- **Middleware** (legacy) - Sequential event processing chain with `MiddlewarePayload` objects
- **Plugins** (current) - Modern extensibility through `EnrichmentPlugin` and `DestinationPlugin` interfaces

**Ampli-Specific Terminology:**
- **Tracking Plan** - Schema definitions sourced from Amplitude Data platform
- **Strongly Typed Events** - Generated event classes with compile-time property validation
- **Event Schemas** - Enforced event structure definitions

## Ecosystem Integration

The Node.js SDK integrates with multiple Amplitude platform components:

**Amplitude Data Platform** serves as the source of truth for tracking plan definitions, generating strongly-typed Ampli wrapper code through automated CLI workflows.

**Ampli CLI** manages tracking plan synchronization with commands like `ampli pull` for schema downloads and `ampli status` for implementation validation against defined schemas.

**Analytics Infrastructure** processes events through Amplitude's HTTP V2 API or batch API endpoints, supporting EU data residency through configurable `serverUrl` parameters.

**Revenue Analytics** provides specialized tracking through the `Revenue` interface for e-commerce implementations with product-specific property validation.

## API Endpoints and Command Interface

**CLI Commands:**
- `ampli pull` - Downloads latest tracking plan schemas from Amplitude Data
- `ampli status` - Validates local implementation against remote tracking plan definitions

**SDK Initialization:**
```javascript
// Current SDK
amplitude.init('API_KEY', configuration)

// Legacy SDK
new AmplitudeClient('API_KEY', configuration)
```

**Event Tracking APIs:**
- Current: `amplitude.track(eventType, eventProperties, eventOptions)`
- Legacy: `client.logEvent(event)`

**Default Endpoints:**
- Standard: `https://api2.amplitude.com/2/httpapi`
- EU Residency: `https://api.eu.amplitude.com/2/httpapi`
- Batch API: Configurable via `transportProvider` settings

The SDK supports single-instance and multi-instance deployment patterns with comprehensive debugging through `logLevel` configuration and privacy controls via `setOptOut()` methods. Migration utilities facilitate transitions from legacy to current SDK implementations while maintaining backward compatibility for existing tracking infrastructure.