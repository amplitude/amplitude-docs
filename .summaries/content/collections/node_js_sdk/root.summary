# Amplitude Node.js SDK

## Overview

The Amplitude Node.js SDK is a server-side analytics tracking solution for sending event data to Amplitude from Node.js applications. It enables developers to track user behavior, manage user properties, and analyze application usage patterns with features like event batching, retry handling, and an extensible plugin architecture.

The SDK is available in two versions:
- **Latest version**: `@amplitude/analytics-node` - Current, actively maintained SDK with TypeScript support and plugin architecture
- **Legacy version**: `@amplitude/node` - Maintenance-mode SDK being phased out

The ecosystem also includes the Ampli Wrapper, a code generation tool that creates strongly-typed facades over the Amplitude SDK based on tracking plans defined in Amplitude Data.

## Key Features

- **Event Tracking**: Track user actions and custom events with rich metadata
- **User Properties Management**: Set, update, and manage user attributes
- **Revenue Tracking**: Track revenue-related events with specialized APIs
- **User Groups**: Associate users with one or more groups for organizational analysis
- **Event Batching**: Efficiently send events in batches to minimize network requests
- **Retry Handling**: Automatically retry failed event submissions
- **Plugin Architecture**: Extend functionality through custom plugins
- **EU Data Residency**: Option to route data to EU servers for compliance
- **TypeScript Support**: Built-in type definitions for improved developer experience
- **Debugging Utilities**: Configurable logging levels for troubleshooting

## Product Relationships

### Core Components

1. **Node.js SDK (`@amplitude/analytics-node`)**: Main SDK for server-side event tracking
2. **Ampli Wrapper**: Generated, strongly-typed API layer built on top of the SDK
3. **ampli CLI**: Command-line tool for generating the Ampli Wrapper code

### Integration Flow

The typical integration flow involves:
1. Defining a tracking plan in Amplitude Data (optional but recommended)
2. Installing the Node.js SDK in your application
3. Optionally generating an Ampli Wrapper using the ampli CLI
4. Initializing the SDK or Ampli Wrapper in your application
5. Tracking events throughout your application code

## Key Nomenclature and Definitions

- **Event**: A discrete user action or occurrence that is tracked
- **User Properties**: Attributes associated with a user (demographics, preferences, etc.)
- **Identify**: API for setting or updating user properties
- **Track**: Method for sending events to Amplitude
- **Flush**: Manually force sending of any queued events
- **setGroup**: Associate a user with one or more groups
- **Plugin**: Extension point for customizing SDK behavior
- **Middleware** (legacy): Extension point in the older SDK version
- **Tracking Plan**: Schema definition for events and properties in Amplitude Data
- **Ampli Wrapper**: Generated code providing type-safe event tracking based on a tracking plan
- **Event Validation**: Verification that events conform to the tracking plan schema

## Product Ecosystem Integration

The Node.js SDK integrates with the broader Amplitude ecosystem:

1. **Amplitude Data**: Defines tracking plans that can be used to generate the Ampli Wrapper
2. **Amplitude Analytics**: Receives and processes events sent by the SDK
3. **Amplitude Experiment**: Can be used alongside the SDK for server-side feature flagging
4. **Cross-Platform Tracking**: Works with client-side SDKs to provide a complete view of user journeys

The SDK is designed for server-side applications and complements client-side SDKs for web, mobile, and other platforms. Events from all sources are unified in the Amplitude Analytics dashboard.

## API Endpoints and Usage

### Installation

```bash
# For the latest SDK
npm install @amplitude/analytics-node

# For the Ampli Wrapper (if using a tracking plan)
npm install @amplitude/analytics-node
```

### Basic SDK Initialization

```javascript
import { createInstance } from '@amplitude/analytics-node';

const amplitude = createInstance();
amplitude.init('API_KEY', {
  serverUrl: 'https://api2.amplitude.com/2/httpapi', // Default endpoint
  // Optional configuration
  flushQueueSize: 200,
  flushIntervalMillis: 10000,
  logLevel: 0
});
```

### Event Tracking

```javascript
// Track an event
amplitude.track({
  event_type: 'Button Clicked',
  user_id: 'user@example.com',
  event_properties: {
    buttonColor: 'blue',
    buttonText: 'Sign Up'
  }
});

// Identify a user
amplitude.identify({
  user_id: 'user@example.com',
  user_properties: {
    $set: {
      name: 'John Doe',
      plan: 'premium'
    },
    $add: {
      loginCount: 1
    }
  }
});

// Set a user group
amplitude.setGroup('organization', 'org-123');

// Flush events manually
amplitude.flush();
```

### Ampli Wrapper Usage

```typescript
// After generating the Ampli Wrapper
import { ampli } from './ampli';

// Initialize
ampli.load({
  client: {
    apiKey: 'API_KEY'
  }
});

// Track a strongly-typed event defined in your tracking plan
ampli.trackEvent('Button Clicked', {
  buttonColor: 'blue',
  buttonText: 'Sign Up'
});

// Identify a user with strongly-typed properties
ampli.identify('user@example.com', {
  userProp1: 'value1'
});
```

### Plugin Registration

```javascript
import { createInstance } from '@amplitude/analytics-node';

// Create a custom plugin
const myPlugin = {
  name: 'my-plugin',
  type: 'before',
  execute: async (context) => {
    // Modify event before sending
    context.event.event_properties.modified = true;
    return context;
  }
};

// Register the plugin
const amplitude = createInstance();
amplitude.init('API_KEY');
amplitude.add(myPlugin);
```