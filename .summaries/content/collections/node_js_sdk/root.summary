# Amplitude Node.js SDK

## Overview

The Amplitude Node.js SDK is a server-side analytics tracking solution for monitoring user behavior and events in Node.js applications. Built with TypeScript, it provides comprehensive event tracking, user identification, and data management capabilities. The SDK offers two implementation approaches: a standard SDK and a strongly-typed Ampli Wrapper generated from Amplitude Data tracking plans.

Key features include:
- Event batching with reliable delivery and retry handling
- User and group identification
- Revenue tracking
- Plugin architecture for customization
- EU data residency support
- TypeScript support with built-in type definitions
- Strongly-typed event tracking via the Ampli Wrapper

## Product Components

The Node.js SDK ecosystem consists of two main components:

1. **Core Node.js SDK** (`@amplitude/analytics-node`) - The foundation package providing core functionality for event tracking, user property management, and SDK configuration.

2. **Ampli Wrapper** - A generated, strongly-typed API layer built on top of the core SDK that enables type-safe event tracking based on tracking plans defined in Amplitude Data.

## Key Nomenclature and Definitions

- **Event Tracking**: Recording user actions and behaviors as events in Amplitude
- **User Properties**: Attributes associated with users that provide context for analysis
- **Group Identification**: Associating users with organizational groups for group-level analytics
- **Tracking Plan**: Schema defining expected events and their properties for an application
- **Plugins**: Modular components that customize SDK behavior
- **Middleware**: (In the maintenance SDK) Functions that intercept and modify events before sending
- **Flush**: The process of immediately sending batched events to Amplitude servers
- **Batch Processing**: Grouping multiple events to send in a single network request

## Integration with Amplitude Ecosystem

The Node.js SDK integrates with other Amplitude products:

1. **Amplitude Data**: The Ampli Wrapper is generated from tracking plans defined in Amplitude Data, ensuring consistency between implementation and documentation.

2. **Amplitude Analytics**: All tracked events are sent to Amplitude Analytics for analysis, visualization, and insights.

3. **EU Data Residency**: The SDK supports sending data to EU servers for regulatory compliance.

## API Endpoints

The SDK communicates with the following Amplitude endpoints:

- Standard API: `https://api.amplitude.com`
- EU Data Residency: `https://api.eu.amplitude.com`
- HTTP V2 API for event ingestion

## Implementation Details

### Installation

```bash
# Core SDK
npm install @amplitude/analytics-node

# Ampli Wrapper CLI
npm install -g @amplitude/ampli
```

### Core SDK Usage

```javascript
// Initialization
import { init, track, identify, setUserId, groupIdentify, setGroup, flush } from '@amplitude/analytics-node';

init('API_KEY', {
  serverUrl: 'https://api.amplitude.com',
  flushQueueSize: 200,
  flushIntervalMillis: 10000,
  logLevel: 0
});

// Event tracking
track('Event Name', {
  property1: 'value1',
  property2: 'value2'
}, {
  user_id: 'user@example.com'
});

// User identification
setUserId('user@example.com');
identify({
  userProperties: {
    $set: { name: 'John Doe', plan: 'premium' },
    $add: { loginCount: 1 }
  }
});

// Group identification
setGroup('orgId', ['org_1', 'org_2']);
groupIdentify('orgId', 'org_1', {
  $set: {
    name: 'Amplitude',
    industry: 'Analytics'
  }
});

// Manual event flushing
await flush();
```

### Ampli Wrapper Usage

```bash
# CLI commands
ampli pull    # Pull tracking plan from Amplitude
ampli status  # Check implementation status
```

```javascript
// Initialization
import { ampli } from './ampli';

ampli.load({
  client: {
    apiKey: 'API_KEY',
    configuration: { /* Optional configuration */ }
  }
});

// Type-safe event tracking
ampli.songPlayed({
  songId: 'song-123',
  songName: 'Bohemian Rhapsody',
  artist: 'Queen'
});

// User identification
ampli.identify('user-123', {
  userProperties: {
    $set: { plan: 'premium' }
  }
});
```

## Migration from Maintenance SDK

The latest Node.js SDK (`@amplitude/analytics-node`) replaces the maintenance SDK (`@amplitude/node`) with several key differences:

1. **Initialization**: Uses `init()` instead of creating an `Amplitude` instance
2. **API Methods**: Renamed methods (e.g., `logEvent()` → `track()`)
3. **Architecture**: Plugin architecture instead of middleware
4. **TypeScript Support**: Built-in type definitions

API Method Mapping:
- `amplitude.logEvent()` → `track()`
- `amplitude.setUserId()` → `setUserId()`
- `amplitude.setUserProperties()` → `identify()`
- `amplitude.setGroup()` → `setGroup()`
- `amplitude.groupIdentify()` → `groupIdentify()`
- `amplitude.logRevenue()` → `revenue()`
- `amplitude.flush()` → `flush()`

## Configuration Options

Key configuration options include:
- `flushQueueSize`: Maximum events to batch before sending (default: 200)
- `flushIntervalMillis`: Automatic batch sending interval (default: 10000ms)
- `serverUrl`: API endpoint for sending events
- `serverZone`: Set to 'EU' for EU data residency
- `logLevel`: Controls SDK log verbosity
- `minIdLength`: Minimum length for user and device IDs
- `transportProvider`: Custom transport implementation for sending events