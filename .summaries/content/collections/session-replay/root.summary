## Amplitude Session Replay

Amplitude Session Replay is a comprehensive user behavior analytics solution that captures and reconstructs user interactions across web, mobile, and React Native applications. The product enables organizations to record, analyze, and visualize user sessions through DOM capture, view tree recording, and behavioral heatmaps while maintaining strict privacy compliance and data protection standards.

## Product Architecture and Integration Ecosystem

Session Replay operates through multiple implementation patterns designed to accommodate diverse technical architectures:

**SDK Integration Models:**
- **Plugin Architecture**: Integrates with existing Amplitude Analytics SDKs (Browser SDK 2, Android-Kotlin SDK, iOS Swift SDK) through `amplitude.add()` plugin registration
- **Middleware Pattern**: Works with maintenance SDKs (Android SDK 2.40.1+, iOS SDK 8.21.0+) via `addEventMiddleware()` integration
- **Standalone SDKs**: Independent implementation for organizations using third-party analytics providers (Segment, Rudderstack) requiring manual session/device ID synchronization
- **Third-Party Wrappers**: Purpose-built integrations for Google Tag Manager, Segment Analytics, and Rudderstack with automatic session correlation

**Cross-Platform Coverage:**
- **Web**: Browser SDK Plugin (`@amplitude/plugin-session-replay-browser`) and Standalone SDK (`@amplitude/session-replay-browser`)
- **Android**: Plugin, Middleware, and Standalone variants supporting both Android-Kotlin and maintenance SDKs
- **iOS/iPadOS**: Plugin (`AmplitudeSwiftSessionReplayPlugin`), Middleware (`AmplitudeiOSSessionReplayMiddleware`), and Standalone implementations
- **React Native**: SDK Plugin (`@amplitude/plugin-session-replay-react-native`) with AmpMaskView masking components

## Core Technical Components

**Session Recording Mechanisms:**
- **DOM Capture and Diff Processing**: Browser implementations capture DOM snapshots and generate incremental diffs for efficient replay reconstruction
- **View Tree Capture**: Mobile SDKs record native view hierarchies and apply diff-based replay generation
- **WebView Tracking**: Cross-platform WebView content recording within native mobile applications

**Data Processing and Storage:**
- **IndexedDB Storage**: Browser implementations use configurable `storeType` for local session data buffering
- **Compression**: Experimental `webworker` compression for bandwidth optimization
- **Performance Optimization**: `requestIdleCallback` integration for non-blocking DOM processing

## Privacy and Compliance Framework

**Multi-Level Masking System:**
- **Conservative**: Maximum privacy protection with comprehensive PII masking
- **Light**: Minimal masking for basic privacy compliance
- **Medium**: Balanced approach between usability and privacy protection

**Masking Implementation:**
- **CSS Selector-Based**: Custom masking rules using CSS selectors and data attributes
- **Component-Level**: Platform-specific masking (AmpMaskView for React Native, .amp-block classes for web)
- **UGC Filter Rules**: Glob pattern-based URL sanitization through `ugcFilterRules` configuration for user-generated content anonymization

**Consent Management:**
- **CMP Integration**: Cookie banner and Consent Management Platform compatibility
- **GDPR Compliance**: Built-in opt-out mechanisms and user consent controls
- **Remote Configuration**: Centralized privacy settings with SDK/UI conflict resolution precedence

## Key Configuration Parameters

**Sampling and Performance:**
- `sampleRate`: Statistical sampling for session recording (0.0-1.0)
- `enableRemoteConfig`: Server-side configuration management
- `serverZone`: EU data residency compliance
- `optOut`: User-level consent management

**Session Management:**
- `setSessionId()` / `setDeviceId()`: Manual session correlation for standalone implementations
- `getSessionReplayProperties()`: Session metadata extraction for event enrichment
- `forceSessionTracking`: Override sampling decisions for specific sessions

## Analytics and Visualization Features

**Heatmaps Functionality:**
- **Click Maps**: User interaction density visualization
- **Selector Maps**: Element-specific engagement tracking  
- **Scroll Maps**: Viewport scroll depth and page fold analysis
- **Behavioral Cohorts**: User segment-based heatmap filtering

**Monitoring and Debugging:**
- **Ingestion Monitor**: Real-time session replay ingestion status tracking with HTTP status code analysis (200, 429, 402)
- **Invalid Session ID Detection**: Implementation debugging for session correlation issues
- **Debug Mode**: Development-time instrumentation validation

## API Endpoints and Methods

**Core SDK Methods:**
- `sessionReplay.init()`: SDK initialization with configuration
- `sessionReplay.start()` / `sessionReplay.stop()`: Recording lifecycle management
- `amplitude.add(plugin)` / `amplitude.remove(plugin)`: Plugin lifecycle for integrated implementations
- `addEventMiddleware()` / `removeEventMiddleware()`: Middleware management for maintenance SDKs

**Integration-Specific APIs:**
- `createSegmentActionsPlugin()`: Segment Analytics integration factory
- `createSegmentSessionReplayPlugin()`: React Native Segment plugin creation
- `getSessionReplayProperties()`: Session metadata extraction for third-party analytics correlation

**Configuration Endpoints:**
- `configServerUrl`: Remote configuration retrieval
- `trackServerUrl`: Session data transmission endpoint
- `flushMaxRetries`: Upload retry configuration

## Third-Party Integration Ecosystem

**Segment Integration Modes:**
- **Actions Destination**: Modern Segment destination with automatic session ID injection
- **Classic Device-Mode**: Client-side Segment implementation with middleware session correlation
- **Classic Cloud-Mode**: Server-side Segment processing with session property forwarding

**Google Tag Manager**: GTM Web Template with Session Replay Plugin toggle and multiple SDK instantiation conflict resolution

**Rudderstack**: Cloud-mode integration with `rudderAnalytics.track()` and `rudderAnalytics.page()` method overrides for session property injection

The product integrates seamlessly with Amplitude's broader analytics ecosystem while providing flexible deployment options for organizations with diverse technical requirements and privacy compliance needs.