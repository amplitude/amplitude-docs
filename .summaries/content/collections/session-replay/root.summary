# Amplitude Session Replay

Amplitude Session Replay is a comprehensive user behavior analytics solution that captures and reconstructs user interactions across web, mobile (iOS/Android), and React Native applications. The product provides visual insights through session recordings, heatmaps, and behavioral analytics while maintaining strict privacy controls and compliance with data protection regulations like GDPR.

## Product Architecture and Integration Patterns

Session Replay operates through multiple integration patterns designed to accommodate different analytics architectures:

**Native Amplitude Integrations:**
- **Browser SDK Plugin** (`@amplitude/plugin-session-replay-browser`) - For sites using Amplitude Browser SDK 2
- **Android Plugin/Middleware** - Supporting both Android-Kotlin SDK and maintenance Android SDK
- **iOS Plugin/Middleware** - Compatible with iOS Swift SDK and legacy iOS SDK  
- **React Native SDK Plugin** (`@amplitude/plugin-session-replay-react-native`)

**Standalone SDKs:**
- **Browser Standalone SDK** (`@amplitude/session-replay-browser`) - For third-party analytics providers
- **Android Standalone SDK** - Manual session/device ID management
- **iOS Standalone SDK** - Non-Amplitude analytics integration

**Third-Party Analytics Integrations:**
- **Segment Integration** - Supporting Amplitude Actions, Classic Device-mode, and Cloud-mode destinations
- **Rudderstack Integration** - Cloud-mode wrapper with deviceId/sessionId mapping
- **Google Tag Manager** - GTM Web Template for client-side implementation

## Core Features and Capabilities

**Session Recording:**
- DOM capture and diff-based replay construction for web applications
- View tree capture for mobile platforms (iOS/Android)
- Real-time session reconstruction with interaction tracking
- WebView support across platforms

**Heatmaps:**
- Click maps showing user interaction hotspots
- Selector maps ranking interactive elements
- Scroll maps with depth analysis and average page fold metrics
- URL pattern matching (exact, pattern, contains, starts with)

**Privacy and Masking:**
- Three masking levels: Conservative, Light, and Medium
- CSS selector-based masking overrides
- Custom masking components (AmpMaskView for React Native)
- UGC Filter Rules using glob patterns for URL sanitization
- First-party cookie implementation for privacy compliance

## Key Nomenclature and Technical Concepts

**Session Management:**
- **Session ID** - Unique identifier linking replay data to analytics sessions
- **Device ID** - Cross-session user identification
- **Sample Rate** - Percentage of sessions recorded (0.0-1.0)
- **Session Replay ID** - Event property (`[Amplitude] Session Replay ID`) for linking events to recordings

**Configuration Parameters:**
- **sampleRate** - Controls recording frequency
- **maskLevel** - Privacy masking intensity
- **serverZone** - Data residency (EU support)
- **optOut** - User consent controls
- **enableRemoteConfig** - Server-side configuration management

**Data Processing:**
- **DOM Capture** - Web element state recording
- **View Tree Capture** - Mobile UI hierarchy recording
- **Diff Processing** - Incremental change detection
- **IndexedDB Storage** - Browser-based local storage (configurable via storeType)

## Privacy and Compliance Framework

Session Replay implements comprehensive privacy controls through multiple layers:

**Consent Management:**
- Integration with Consent Management Platforms (CMPs)
- Cookie banner compatibility
- Privacy policy disclosure templates
- SDK-level consent controls with remote configuration precedence

**Data Masking:**
- **Conservative** - Maximum privacy, minimal data capture
- **Light** - Balanced privacy with functional insights  
- **Medium** - Enhanced insights with targeted masking
- CSS selector overrides for granular control
- Conflict resolution between SDK and UI settings

**Regulatory Compliance:**
- GDPR compliance mechanisms
- DSAR API support for data subject requests
- User Privacy API for data deletion
- First-party cookie classification for analytics

## Monitoring and Debugging Tools

**Ingestion Monitor:**
- Real-time session replay ingestion status tracking
- HTTP status code monitoring (200, 429, 402)
- Invalid session ID detection
- Implementation troubleshooting capabilities

**Performance Configuration:**
- Idle compression settings
- Web Worker support (experimental)
- CSS asset loading optimization
- Shadow DOM compatibility

## API Endpoints and Methods

**Core SDK Methods:**
- `sessionReplay.init()` - SDK initialization
- `sessionReplay.setSessionId()` - Manual session management
- `getSessionReplayProperties()` - Event property injection
- `start()` / `stop()` - Recording control
- `amplitude.add()` / `amplitude.remove()` - Plugin management

**Integration-Specific Methods:**
- `addEventMiddleware()` / `removeEventMiddleware()` - Android/iOS middleware
- `createSegmentActionsPlugin()` - Segment integration
- `rudderAnalytics.track()` / `rudderAnalytics.page()` - Rudderstack overrides

**Configuration APIs:**
- `privacyConfig` - Masking configuration
- `interactionConfig` - UGC filtering rules
- `performanceConfig` - Optimization settings
- `SessionReplayConfig` - React Native configuration object

The product integrates seamlessly with Amplitude's broader analytics ecosystem while providing flexible deployment options for organizations using alternative analytics platforms, ensuring comprehensive user behavior insights regardless of the underlying analytics architecture.