## Amplitude Session Replay

Amplitude Session Replay is a comprehensive user behavior analytics platform that captures and reconstructs user interactions across web, mobile (iOS/Android), and React Native applications. The solution provides visual insights through session recordings, heatmaps, and behavioral analytics while maintaining enterprise-grade privacy controls and regulatory compliance capabilities.

## Product Architecture and Integration Ecosystem

Session Replay operates through a multi-tiered SDK architecture designed for diverse integration scenarios:

**Native Amplitude Integration Layer:**
- **Browser SDK Plugin** (`@amplitude/plugin-session-replay-browser`) - Direct integration with Amplitude Browser SDK 2
- **iOS Plugin** (`AmplitudeSwiftSessionReplayPlugin`) - Compatible with iOS Swift SDK and legacy iOS implementations
- **Android Plugin** (`SessionReplayPlugin`) - Supports Android-Kotlin SDK and maintenance Android SDK versions
- **React Native Plugin** (`@amplitude/plugin-session-replay-react-native`) - Native integration with Amplitude React Native SDK

**Middleware Integration Layer:**
- **iOS Middleware** (`AmplitudeiOSSessionReplayMiddleware`) - Bridges maintenance Amplitude iOS SDK 8.21.0+
- **Android Middleware** (`SessionReplayMiddleware`) - Connects maintenance Amplitude Android SDK 2.40.1+

**Standalone SDK Layer:**
- **Browser Standalone** (`@amplitude/session-replay-browser`) - Independent implementation for third-party analytics providers
- **iOS Standalone** (`AmplitudeSessionReplay`) - Manual session/device ID management capabilities
- **Android Standalone** - Third-party analytics integration support
- **React Native Standalone** (`@amplitude/session-replay-react-native`) - Framework-independent implementation

**Third-Party Integration Layer:**
- **Segment Integration** - Multi-mode support (Actions, Classic Device-mode, Cloud-mode)
- **Google Tag Manager** - GTM Web Template implementation
- **Rudderstack Integration** - Cloud-mode wrapper with comprehensive ID mapping

## Core Features and Capabilities

**Session Recording Engine:**
The platform captures user interactions through DOM capture and differential processing (web) and view tree capture (mobile), creating compressed, reconstructable session recordings. Browser implementations utilize IndexedDB storage with configurable retention periods and optional webworker compression.

**Heatmap Analytics:**
- **Click Maps** - Spatial analysis of user click interaction patterns
- **Selector Maps** - Element-specific engagement and interaction data
- **Scroll Maps** - Vertical and horizontal scrolling behavior analysis
- **Microscope Feature** - Granular interaction analysis and detailed behavioral insights

**Privacy and Compliance Framework:**
- **Masking Levels** - Tiered privacy configurations (Conservative, Light, Medium)
- **CSS Selector Overrides** - Granular mask/unmask/exclude element control
- **UGC Filter Rules** - Glob pattern-based URL sanitization for user-generated content
- **Consent Management** - CMP integration, GDPR compliance, and user opt-out mechanisms
- **Data Masking** - PII protection with configurable masking strategies

## Key Nomenclature and Definitions

**Core Configuration Parameters:**
- **sampleRate** - Session recording percentage control (0.0-1.0 range)
- **maskLevel** - Privacy masking intensity configuration (Conservative/Light/Medium)
- **deviceId** - Unique device identifier for cross-session correlation
- **sessionId** - Session tracking identifier with manual management capabilities
- **serverZone** - Data residency control (US/EU geographic routing)
- **enableRemoteConfig** - Server-side configuration management enablement
- **optOut** - User consent and privacy control mechanism

**Technical Architecture Components:**
- **Session Replay ID** - Unique identifier attached as `[Amplitude] Session Replay ID` event property
- **getSessionReplayProperties()** - Method returning session metadata for event correlation
- **AmpMaskView** - React Native component for sensitive data masking
- **privacyConfig** - Browser SDK privacy configuration object
- **interactionConfig** - Interaction tracking and UGC filtering configuration

**Privacy Control Mechanisms:**
- **amp-mask/amp-unmask/amp-block** - CSS classes and component attributes for data protection
- **ugcFilterRules** - URL sanitization rules using glob patterns with selector/replacement pairs
- **shouldInlineStylesheet** - CSS handling configuration for replay fidelity optimization

## API Endpoints and Core Methods

**Primary SDK Methods:**
- `sessionReplay.init()` - Initialize standalone SDK with configuration parameters
- `sessionReplay.setSessionId()` - Manual session ID management and synchronization
- `sessionReplay.setDeviceId()` - Device ID synchronization across sessions
- `sessionReplay.start()/stop()` - Recording lifecycle control methods
- `sessionReplay.flush()` - Force immediate data transmission
- `amplitude.add(plugin)/amplitude.remove(plugin)` - Plugin lifecycle management

**Integration and Middleware Methods:**
- `addEventMiddleware()/removeEventMiddleware()` - Middleware attachment for legacy SDK versions
- `createSegmentActionsPlugin()` - Segment integration factory method
- `createSegmentSessionReplayPlugin()` - React Native Segment plugin creation

**Monitoring and Debugging Infrastructure:**
- **Session Replay Ingestion Monitor** - HTTP status code tracking (200, 429, 402) and invalid session ID detection
- **debugMode** - Development instrumentation and troubleshooting capabilities
- **configServerUrl/trackServerUrl** - Custom endpoint configuration for enterprise deployments

## Platform-Specific Implementation Details

**Browser Platform:**
- Shadow DOM support with comprehensive DOM tree capture
- IndexedDB storage with configurable retention policies
- Experimental webworker compression for performance optimization
- requestIdleCallback integration for non-blocking performance
- CSS stylesheet inlining for high-fidelity replay reconstruction

**Mobile Platform Implementations:**
- View tree capture with differential replay construction
- Limited WebView and MapView component support
- Jetpack Compose framework support (Android)
- NullPointerException handling and recovery (React Native Android)
- Native component masking through AmpMaskView

**Enterprise Compliance and Data Governance:**
- EU data residency through ServerZone.EU configuration
- DSAR API and User Privacy API compliance integration
- Configurable data retention periods for regulatory compliance
- First-party cookies categorization for analytics compliance frameworks

The Session Replay ecosystem delivers comprehensive user behavior analytics through a flexible, privacy-first architecture that supports enterprise-scale deployments across multiple platforms while maintaining strict data governance and regulatory compliance standards.