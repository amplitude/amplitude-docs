# Amplitude Session Replay

Amplitude Session Replay is a comprehensive user behavior analytics solution that captures and reconstructs user interactions across web, mobile (iOS/Android), and React Native applications. The product provides visual insights through session recordings, heatmaps, and behavioral analytics while maintaining robust privacy controls and compliance features.

## Product Architecture and Integration Patterns

Session Replay operates through multiple integration patterns designed to accommodate different analytics architectures:

**Native Amplitude Integrations:**
- **Browser SDK Plugin** (`@amplitude/plugin-session-replay-browser`) for sites using Amplitude Browser SDK 2
- **iOS Plugin** (`AmplitudeSwiftSessionReplayPlugin`) for iOS Swift SDK integration
- **Android Plugin** (`SessionReplayPlugin`) for Android-Kotlin SDK integration
- **React Native Plugin** (`@amplitude/plugin-session-replay-react-native`) for React Native applications

**Middleware Implementations:**
- **iOS Middleware** (`AmplitudeiOSSessionReplayMiddleware`) for maintenance iOS SDK (8.21.0+)
- **Android Middleware** (`SessionReplayMiddleware`) for maintenance Android SDK (2.40.1+)

**Standalone SDKs:**
- **Browser Standalone SDK** (`@amplitude/session-replay-browser`) for non-Amplitude analytics providers
- **iOS Standalone SDK** for third-party analytics integration
- **Android Standalone SDK** for external analytics platforms

**Third-Party Analytics Integrations:**
- **Segment Integration** supporting Amplitude Actions, Classic Device-mode, and Cloud-mode destinations
- **Rudderstack Integration** with Cloud-mode configuration
- **Google Tag Manager (GTM)** implementation via GTM Web Template

## Core Features and Capabilities

**Session Recording:**
Session Replay captures DOM interactions through view tree capture and diff-based reconstruction, storing data in IndexedDB with configurable compression. The system tracks user interactions, form inputs, clicks, and navigation patterns while maintaining session continuity across page loads.

**Heatmaps:**
Available for Growth/Enterprise plans, Heatmaps provide visual engagement analytics through:
- **Click Maps** showing interaction hotspots
- **Selector Maps** displaying element-specific engagement
- **Scroll Maps** revealing viewport scroll depth and average page fold metrics

**Privacy and Masking:**
The system implements three masking levels:
- **Conservative**: Maximum data protection with extensive PII masking
- **Light**: Minimal masking for basic privacy compliance
- **Medium**: Balanced approach between insights and privacy

Custom masking supports CSS selector-based overrides, `AmpMaskView` components for React Native, and `.amp-block` class exclusions.

## Key Nomenclature and Technical Concepts

**Session Management:**
- **Session ID**: Unique identifier linking replay data to analytics sessions
- **Device ID**: Cross-session user identifier for behavioral continuity
- **Sample Rate**: Percentage-based recording frequency control (0.0-1.0)

**Configuration Parameters:**
- **`sampleRate`**: Controls recording frequency to manage data volume and costs
- **`enableRemoteConfig`**: Enables server-side configuration management
- **`serverZone`**: Supports EU data residency requirements
- **`optOut`**: User consent and privacy control mechanism
- **`forceSessionTracking`**: Ensures session continuity for replay correlation

**Privacy Controls:**
- **`privacyConfig`**: Comprehensive masking configuration object
- **`maskLevel`**: Predefined privacy protection levels
- **`ugcFilterRules`**: Glob pattern-based URL sanitization for user-generated content
- **Consent Management Platform (CMP)**: Integration for GDPR and privacy regulation compliance

**Data Processing:**
- **DOM Capture**: Real-time document structure recording
- **Diff Processing**: Incremental change detection for efficient storage
- **IndexedDB Storage**: Client-side data persistence before transmission
- **WebWorker Processing**: Experimental background processing for performance optimization

## Ecosystem Integration and Data Flow

Session Replay integrates with Amplitude's broader analytics ecosystem through standardized event properties and session correlation:

**Event Correlation:**
All recorded sessions inject `[Amplitude] Session Replay ID` properties into analytics events, enabling correlation between quantitative metrics and qualitative replay data. The `getSessionReplayProperties()` method provides programmatic access to replay metadata for custom event tagging.

**Monitoring and Debugging:**
The **Session Replay Ingestion Monitor** tracks ingestion health through HTTP status monitoring:
- **Status 200**: Successful replay data ingestion
- **Status 429**: Rate limiting and throttling alerts
- **Status 402**: Quota exceeded notifications
- **Invalid Session IDs**: Implementation debugging assistance

**Data Residency and Compliance:**
EU data residency support through `serverZone` configuration ensures GDPR compliance, while DSAR (Data Subject Access Request) API integration provides user data deletion capabilities. The system supports comprehensive consent management through CMP integration and cookie banner controls.

**API Integration Points:**
- **`amplitude.add(plugin)`** and **`amplitude.remove(plugin)`**: Plugin lifecycle management
- **`sessionReplay.start()`** and **`sessionReplay.stop()`**: Programmatic recording control
- **`setSessionId()`** and **`setDeviceId()`**: Manual session correlation for standalone implementations
- **`flush()`**: Immediate data transmission for critical session boundaries

The product architecture supports both automatic session tracking through native SDK integration and manual session management for complex analytics environments, providing flexibility while maintaining data integrity and user privacy compliance.