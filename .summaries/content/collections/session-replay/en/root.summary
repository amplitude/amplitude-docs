## Amplitude Session Replay

Amplitude Session Replay is a comprehensive user behavior analytics solution that captures and reconstructs user interactions across web, mobile (iOS/Android), and React Native applications. The platform provides visual insights through session recordings, heatmaps, and behavioral analytics while maintaining robust privacy controls and compliance capabilities.

## Product Architecture and Integration Ecosystem

Session Replay operates through multiple SDK implementations designed for different integration scenarios:

**Native Amplitude Integration:**
- **Browser SDK Plugin** (`@amplitude/plugin-session-replay-browser`) - Integrates with Amplitude Browser SDK 2
- **iOS Plugin** (`AmplitudeSwiftSessionReplayPlugin`) - Works with iOS Swift SDK and legacy iOS SDK
- **Android Plugin** (`SessionReplayPlugin`) - Compatible with Android-Kotlin SDK and maintenance Android SDK
- **React Native Plugin** (`@amplitude/plugin-session-replay-react-native`) - Integrates with Amplitude React Native SDK

**Middleware Solutions:**
- **iOS Middleware** (`AmplitudeiOSSessionReplayMiddleware`) - For maintenance Amplitude iOS SDK 8.21.0+
- **Android Middleware** (`SessionReplayMiddleware`) - For maintenance Amplitude Android SDK 2.40.1+

**Standalone SDKs:**
- **Browser Standalone** (`@amplitude/session-replay-browser`) - For third-party analytics providers
- **iOS Standalone** (`AmplitudeSessionReplay`) - Manual session/device ID management
- **Android Standalone** - Third-party analytics integration
- **React Native Standalone** (`@amplitude/session-replay-react-native`) - Independent implementation

**Third-Party Integrations:**
- **Segment Integration** - Multiple destination modes (Actions, Classic Device-mode, Cloud-mode)
- **Google Tag Manager** - GTM Web Template implementation
- **Rudderstack Integration** - Cloud-mode wrapper with ID mapping

## Core Features and Capabilities

**Session Recording:**
Session Replay captures user interactions through DOM capture and diff processing (web), view tree capture (mobile), creating compressed, reconstructable session recordings stored in IndexedDB (browser) with configurable retention periods.

**Heatmaps:**
Visual engagement analytics including:
- **Click Maps** - User click interaction patterns
- **Selector Maps** - Element-specific engagement data
- **Scroll Maps** - Page scrolling behavior analysis
- **Microscope Feature** - Detailed interaction analysis

**Privacy and Compliance:**
- **Masking Levels** - Conservative, Light, Medium privacy configurations
- **CSS Selector Overrides** - Custom mask/unmask/exclude element rules
- **UGC Filter Rules** - Glob pattern-based URL sanitization for user-generated content
- **Consent Management** - CMP integration, GDPR compliance, opt-out mechanisms
- **Data Masking** - PII protection with configurable masking options

## Key Nomenclature and Definitions

**Configuration Parameters:**
- **sampleRate** - Controls percentage of sessions recorded (0.0-1.0)
- **maskLevel** - Privacy masking intensity (Conservative/Light/Medium)
- **deviceId** - Unique device identifier for session correlation
- **sessionId** - Session tracking identifier with manual management capabilities
- **serverZone** - Data residency control (US/EU)
- **enableRemoteConfig** - Server-side configuration management
- **optOut** - User consent and privacy control mechanism

**Technical Components:**
- **Session Replay ID** - Unique identifier attached as `[Amplitude] Session Replay ID` event property
- **getSessionReplayProperties()** - Method returning session metadata for event tagging
- **AmpMaskView** - React Native component for sensitive data masking
- **privacyConfig** - Browser SDK privacy configuration object
- **interactionConfig** - Configuration for interaction tracking and UGC filtering

**Privacy Controls:**
- **amp-mask/amp-unmask/amp-block** - CSS classes and component attributes for data masking
- **ugcFilterRules** - URL sanitization rules using glob patterns with selector/replacement pairs
- **shouldInlineStylesheet** - CSS handling configuration for replay fidelity

## API Endpoints and Methods

**Core SDK Methods:**
- `sessionReplay.init()` - Initialize standalone SDK with configuration
- `sessionReplay.setSessionId()` - Manual session ID management
- `sessionReplay.setDeviceId()` - Device ID synchronization
- `sessionReplay.start()/stop()` - Recording control methods
- `sessionReplay.flush()` - Force data transmission
- `amplitude.add(plugin)/amplitude.remove(plugin)` - Plugin lifecycle management

**Integration Methods:**
- `addEventMiddleware()/removeEventMiddleware()` - Middleware attachment for legacy SDKs
- `createSegmentActionsPlugin()` - Segment integration factory
- `createSegmentSessionReplayPlugin()` - React Native Segment plugin creation

**Monitoring and Debugging:**
- **Session Replay Ingestion Monitor** - Tracks HTTP status codes (200, 429, 402) and invalid session IDs
- **debugMode** - Development instrumentation and troubleshooting
- **configServerUrl/trackServerUrl** - Custom endpoint configuration

## Platform-Specific Considerations

**Browser Implementation:**
- Shadow DOM support, IndexedDB storage, webworker compression (experimental)
- requestIdleCallback performance optimization
- CSS stylesheet inlining for replay fidelity

**Mobile Platforms:**
- View tree capture with diff-based replay construction
- Limited WebView and MapView support
- Jetpack Compose support (Android)
- NullPointerException handling (React Native Android)

**Data Residency and Compliance:**
- EU data residency through ServerZone.EU configuration
- DSAR API and User Privacy API compliance
- Configurable data retention periods
- First-party cookies categorization for analytics compliance

The Session Replay ecosystem provides comprehensive user behavior analytics while maintaining enterprise-grade privacy controls and flexible integration options across multiple platforms and analytics providers.