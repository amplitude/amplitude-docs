## Amplitude Session Replay

Amplitude Session Replay is a comprehensive user behavior analytics solution that captures and reconstructs user interactions across web, mobile (iOS/Android), and React Native applications. The product provides visual insights through session recordings, heatmaps, and behavioral analytics while maintaining robust privacy controls and compliance features.

## Product Architecture and Integration Patterns

Session Replay operates through multiple integration patterns designed to accommodate different analytics architectures:

**Native Amplitude Integrations:**
- **Browser SDK Plugin** (`@amplitude/plugin-session-replay-browser`) - For sites using Amplitude Browser SDK 2
- **iOS Plugin** (`AmplitudeSwiftSessionReplayPlugin`) - For iOS Swift SDK implementations
- **Android Plugin** (`SessionReplayPlugin`) - For Android-Kotlin SDK implementations
- **React Native Plugin** (`@amplitude/plugin-session-replay-react-native`) - For React Native SDK implementations

**Middleware Implementations:**
- **iOS Middleware** (`AmplitudeiOSSessionReplayMiddleware`) - For maintenance iOS SDK (8.21.0+)
- **Android Middleware** (`SessionReplayMiddleware`) - For maintenance Android SDK (2.40.1+)

**Standalone SDKs:**
- **Browser Standalone** (`@amplitude/session-replay-browser`) - For third-party analytics providers
- **iOS Standalone** (`AmplitudeSessionReplay`) - For non-Amplitude iOS analytics
- **Android Standalone** (`SessionReplay`) - For non-Amplitude Android analytics
- **React Native Standalone** (`@amplitude/session-replay-react-native`) - For non-Amplitude React Native analytics

**Third-Party Analytics Integrations:**
- **Segment Integration** (`@amplitude/segment-session-replay-plugin`) - For Segment Analytics with Amplitude Actions destination
- **Google Tag Manager** - GTM Web Template for browser implementations
- **Rudderstack Integration** - Wrapper for Rudderstack Cloud-mode analytics

## Core Technical Components

**Data Capture Mechanisms:**
- **DOM Capture and Diff Processing** - Browser-based view tree capture with incremental diff transmission
- **View Tree Capture** - Mobile platform native view hierarchy recording
- **WebView Tracking** - Cross-platform web content capture within mobile applications
- **Shadow DOM Support** - Advanced browser DOM structure handling

**Storage and Performance:**
- **IndexedDB Storage** - Browser-based local replay data storage
- **WebWorker Compression** - Background thread data processing
- **RequestIdleCallback Optimization** - Performance-aware capture scheduling

## Key Nomenclature and Definitions

**Session Management:**
- **Session ID** - Unique identifier linking replay data to analytics events, synchronized across analytics providers
- **Device ID** - Cross-session user identifier for replay correlation
- **Session Replay ID** - Event property (`[Amplitude] Session Replay ID`) injected into analytics events
- **Sample Rate** - Percentage-based session capture configuration (0.0-1.0)

**Privacy and Masking:**
- **Masking Levels** - Three-tier privacy system (Conservative, Light, Medium)
- **CSS Selector Masking** - Custom element masking using CSS selectors and data attributes
- **AmpMaskView** - React Native component for element-level privacy control
- **UGC Filter Rules** - URL-based user-generated content sanitization using glob patterns

**Configuration Systems:**
- **Remote Configuration** - Server-side feature flag and setting management
- **Privacy Config** - Client-side data masking and PII protection settings
- **Server Zone** - Data residency configuration (US/EU)
- **Opt-Out Mechanisms** - User consent and privacy compliance controls

## Analytics Integration Patterns

**Event Property Injection:**
All implementations inject session replay metadata through `getSessionReplayProperties()` method, adding the `[Amplitude] Session Replay ID` property to analytics events for correlation.

**ID Synchronization Requirements:**
- **Device ID Matching** - Session replay device ID must match analytics provider device ID
- **Session ID Correlation** - Session timestamps and IDs must align between replay and analytics data
- **Third-Party Mapping** - Anonymous ID and session ID extraction from external analytics providers

## Monitoring and Debugging Tools

**Session Replay Ingestion Monitor:**
- HTTP status code tracking (200, 429, 402)
- Invalid session ID detection
- Ingestion health monitoring
- Implementation troubleshooting support

**Heatmaps Analytics:**
- Click maps, selector maps, and scroll maps
- Viewport scroll depth analysis
- Behavioral cohort integration
- URL pattern matching for page-specific insights

## Privacy and Compliance Framework

**Consent Management:**
- Cookie banner CMP integration
- GDPR compliance controls
- Privacy policy disclosure templates
- First-party cookie categorization

**Data Protection:**
- PII masking and anonymization
- Form field content protection
- Custom CSS selector-based masking
- Conflict resolution between SDK and UI settings

**API Endpoints and Methods:**

**Core SDK Methods:**
- `sessionReplay.init()` - SDK initialization
- `sessionReplay.start()` / `sessionReplay.stop()` - Recording control
- `sessionReplay.setSessionId()` / `sessionReplay.setDeviceId()` - ID management
- `sessionReplay.flush()` - Data transmission
- `getSessionReplayProperties()` - Event property extraction

**Plugin Management:**
- `amplitude.add(plugin)` / `amplitude.remove(plugin)` - Plugin lifecycle
- `addEventMiddleware()` / `removeEventMiddleware()` - Middleware management

The Session Replay ecosystem integrates seamlessly with Amplitude's broader analytics platform while providing flexible integration options for organizations using alternative analytics providers, maintaining consistent privacy controls and data correlation capabilities across all implementation patterns.