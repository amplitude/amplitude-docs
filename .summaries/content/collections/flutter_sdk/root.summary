# Amplitude Flutter SDK

## Overview

The Amplitude Flutter SDK is a cross-platform analytics solution for tracking user behavior in Flutter applications across iOS, Android, macOS, and web platforms. It provides developers with tools for event tracking, user identification, revenue tracking, and session management to gain insights into user interactions and app performance.

The SDK is currently available in two major versions:
- Flutter SDK 4 (current recommended version) - Features a unified API and improved architecture
- Flutter SDK 3 (legacy version) - In maintenance mode

Flutter SDK 4 represents a significant architectural improvement, wrapping the latest native SDKs (iOS, Android, and Browser) to provide consistent functionality across platforms.

## Product Relationships and Architecture

The Amplitude Flutter SDK serves as a cross-platform wrapper around platform-specific native SDKs:

1. **Core SDK Layer**: The Flutter package that provides a unified Dart API
2. **Platform Bridge Layer**: Handles communication between Flutter and native code
3. **Native SDK Layer**: Platform-specific implementations (iOS, Android, Web)

The SDK follows a modular architecture with these key components:
- **Amplitude Instance**: The main entry point for all SDK operations
- **Configuration**: Immutable object pattern for SDK setup
- **Event Pipeline**: Handles event creation, enrichment, and transmission
- **Storage Layer**: Manages persistence of events and user properties

## Key Nomenclature and Definitions

- **BaseEvent**: The fundamental event object structure in SDK 4 that encapsulates all event data
- **Identify**: Object used for user property operations (set, setOnce, add, etc.)
- **Revenue**: Specialized event type for tracking monetary transactions
- **Device ID**: Unique identifier for the device, can be customized or automatically generated
- **User ID**: Custom identifier for logged-in users
- **Event Properties**: Key-value pairs attached to events providing additional context
- **User Properties**: Persistent attributes associated with a user
- **Session**: A period of user engagement with the app, with configurable timeout
- **Tracking Options**: Controls which events are automatically tracked by the SDK
- **Flush**: Process of sending batched events to Amplitude servers

## Integration with Amplitude Ecosystem

The Flutter SDK integrates with the broader Amplitude Analytics platform by:

1. Sending event data to Amplitude's servers for analysis and visualization
2. Supporting EU data residency for compliance with European regulations
3. Enabling server-side user property operations
4. Providing consistent identity management across platforms
5. Supporting Amplitude's dashboard and reporting tools

The SDK acts as the data collection layer in the Amplitude stack, capturing user behavior that can then be analyzed through Amplitude's Analytics, Experiment, and CDP products.

## API and Implementation

### Installation
```yaml
dependencies:
  amplitude_flutter: ^4.0.0
```

### Initialization
```dart
import 'package:amplitude_flutter/amplitude.dart';

final amplitude = Amplitude.getInstance();
amplitude.init('API_KEY', 
  Configuration(
    serverZone: ServerZone.EU,
    flushQueueSize: 30,
    flushIntervalMillis: 10000
  )
);
```

### Event Tracking
```dart
// Basic event tracking
amplitude.track(BaseEvent('Button Clicked'));

// Event with properties
amplitude.track(BaseEvent('Product Viewed')
  ..properties = {'productId': '123', 'price': 29.99});
```

### User Identification
```dart
// Set user ID
amplitude.setUserId('user@example.com');

// Set user properties
final identify = Identify()
  ..set('plan', 'premium')
  ..add('loginCount', 1);
amplitude.identify(identify);

// Group users
amplitude.setGroup('organization', 'company_123');
```

### Revenue Tracking
```dart
final revenue = Revenue()
  ..productId = 'product_1'
  ..price = 3.99
  ..quantity = 2;
amplitude.revenue(revenue);
```

### Session Management
```dart
// Configure session timeout
amplitude.init('API_KEY', Configuration(
  minTimeBetweenSessionsMillis: 30000
));

// Manually start a new session
amplitude.startNewSession();

// End the current session
amplitude.endSession();
```

### Flush Control
```dart
// Manually flush events
amplitude.flush();

// Upload events even when offline
amplitude.uploadEvents();
```

### Opt-out and Privacy
```dart
// Opt out of tracking
amplitude.setOptOut(true);

// COPPA compliance
amplitude.init('API_KEY', Configuration(
  enableCoppaControl: true
));
```

The SDK provides platform-specific considerations for iOS (iOS 13.0+ required), Android (Gradle compatibility), and Web (integration with Browser SDK), along with a migration path from v3 to v4 that involves updating the dependency, initialization pattern, and API usage.