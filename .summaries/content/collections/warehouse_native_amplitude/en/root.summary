# Warehouse-native Amplitude (WNA)

## Product Overview

Warehouse-native Amplitude (WNA) is a solution that allows users to analyze data directly from their Snowflake data warehouse without requiring data ingestion into Amplitude's systems. This approach enables faster access to time-sensitive datasets while leveraging Amplitude's analytical capabilities. Users can create custom data models that map their warehouse data to Amplitude's expected structure, supporting various analysis types including event tracking, user properties, and group properties.

## Key Features and Concepts

1. **Direct Warehouse Connection**: Establishes a read-only connection to Snowflake data warehouses
2. **Custom Data Modeling**: Supports creation of data models that map warehouse data to Amplitude's expected structure
3. **Multiple Data Types Support**: Handles events, user properties, and group properties
4. **Bulk Model Management**: Enables batch creation and updating of multiple models
5. **DBT Integration**: Allows model creation through DBT manifest files and annotations
6. **Performance Optimization**: Provides recommendations for clustering keys and partitioning strategies

## Product Relationships and Architecture

Warehouse-native Amplitude consists of several interconnected components:

1. **Data Models**: The core of WNA, defining how warehouse data maps to Amplitude concepts
   - **Fact Tables**: Contain event data with timestamps and user identifiers
   - **Dimension Tables**: Store supplementary information about users, groups, or events

2. **Model Types**:
   - **EVENT**: Core event data
   - **EVENT_PROPERTIES**: Properties associated with events
   - **USER_PROPERTIES**: Properties of users (current or historical)
   - **GROUP_PROPERTIES**: Properties of groups (current or historical)

3. **Model Creation Methods**:
   - **Direct Table Selection**: Mapping existing Snowflake tables
   - **SQL Query Definition**: Creating custom views through SQL
   - **Bulk Management**: Using YAML configuration files
   - **DBT Integration**: Leveraging DBT manifest files with annotations

## Key Nomenclature and Definitions

1. **Data Model Types**:
   - **Event Data**: Records of user actions with timestamps
   - **User Properties**: Attributes associated with users
   - **Group Properties**: Attributes associated with organizational groups

2. **Schema Structures**:
   - **Star Schema**: Fact table connected directly to dimension tables
   - **Snowflake Schema**: Fact table connected to dimension tables that connect to other dimension tables

3. **Performance Optimization Terms**:
   - **Clustering Keys**: Columns used to organize data for efficient querying
   - **LINEAR() Function**: Used to optimize clustering key selection
   - **Partitioning**: Dividing data into manageable segments for improved query performance

4. **Identity Spaces**: Frameworks for identifying users across different data sources

5. **Model Configuration Components**:
   - **requiredFields**: Essential fields that must be mapped
   - **additionalFields**: Optional fields that can be included
   - **multiEventConfig**: Configuration for models containing multiple event types

## Integration with Product Ecosystem

Warehouse-native Amplitude integrates with:

1. **Snowflake Data Warehouse**: The primary data source, requiring read-only credentials
2. **Amplitude Analytics Platform**: Provides the analytical capabilities and visualization tools
3. **DBT (Data Build Tool)**: Optional integration for managing data transformations and model definitions
4. **Existing Data Infrastructure**: Works with current data warehouse setups without requiring data duplication

## Technical Implementation Details

### Data Model Creation Process

1. Connect to Snowflake warehouse with read-only credentials
2. Select between table-based or SQL-based model creation
3. Map required fields (event_time, user_id, etc.) to corresponding warehouse columns
4. Define additional properties and their mappings
5. Configure identity spaces if needed

### Bulk Model Management

```yaml
# Example YAML configuration for bulk model creation
models:
  - name: "Example Event"
    type: "event"
    selection:
      type: "sql"
      query: "SELECT * FROM events WHERE event_type = 'example'"
    mapping:
      requiredFields:
        event_time: "timestamp"
        user_id: "user_identifier"
      additionalFields:
        event_properties:
          - source_column: "property_a"
            destination_name: "Property A"
```

### DBT Integration

DBT models can be annotated with `amplitude_meta` to define Amplitude data models:

```sql
-- Example DBT model with Amplitude annotation
SELECT * FROM events
WHERE event_type = 'example'

/*
amplitude_meta:
  data_models:
    - type: EVENT
      special_columns:
        event_time: timestamp
        user_id: user_identifier
*/
```

### Performance Optimization Recommendations

1. Use clustering keys with high cardinality for fact tables
2. Apply the LINEAR() function to optimize clustering key selection
3. Choose appropriate schema structure (star or snowflake) based on data complexity
4. Implement effective partitioning strategies for large datasets

## Limitations

1. Some Amplitude features are not supported in warehouse-native mode
2. Performance depends on the underlying warehouse configuration
3. Specific formula constraints apply to warehouse-native implementations