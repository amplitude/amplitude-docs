# Warehouse-native Amplitude (WNA)

## Overview

Warehouse-native Amplitude (WNA) is a solution that enables organizations to analyze data directly from their Snowflake data warehouse without requiring data ingestion into Amplitude's systems. WNA provides Amplitude's analytical capabilities while allowing data to remain in the customer's Snowflake environment, offering faster access to time-sensitive datasets and supporting custom analyses using data models built from warehouse data.

Key features include direct Snowflake connection, custom data model creation, support for various data types (events, user properties, group properties), bulk model management, DBT integration, and performance optimization through clustering keys and partitioning.

## Product Relationships and Architecture

WNA consists of four main components:

1. **Data Connection Layer**: Establishes a read-only connection to the Snowflake data warehouse
2. **Data Modeling Layer**: Enables creation of fact and dimensional tables through direct table selection or SQL queries
3. **Analysis Layer**: Provides Amplitude's analytical capabilities on top of warehouse data
4. **Management Tools**: Includes bulk model management and DBT integration

The system maps warehouse data structures to Amplitude's required formats through data models that define how raw warehouse data should be interpreted as events, user properties, or group properties within Amplitude's analytical framework.

## Key Nomenclature and Definitions

### Data Model Types
- **Event Model**: Represents user actions or system events with associated properties
- **User Properties Model**: Contains attributes about users (current or historical)
- **Group Properties Model**: Contains attributes about groups (current or historical)
- **Event Properties Model**: Contains properties associated with specific events

### Data Structures
- **Fact Table**: Primary table containing event data with metrics and foreign keys
- **Dimension Tables**: Supporting tables with descriptive attributes related to fact table records
- **Star Schema**: Data modeling approach with a central fact table connected to dimension tables
- **Snowflake Schema**: Extended star schema where dimension tables are normalized into multiple related tables

### Technical Concepts
- **Clustering Keys**: Columns used to physically organize data in Snowflake for optimized query performance
- **Identity Spaces**: Frameworks for identifying and connecting users across different data sources
- **Partitioning**: Division of data into segments based on specific columns to improve query performance
- **LINEAR() Function**: Used in clustering key optimization to improve data retrieval efficiency

## Integration with Product Ecosystem

WNA integrates with:
1. **Snowflake Data Warehouse**: Primary data source housing all customer data
2. **DBT (Data Build Tool)**: Allows defining Amplitude models within DBT workflows
3. **Amplitude Analytics Platform**: Provides analytical capabilities and user interface

WNA serves as an alternative data source option within the Amplitude ecosystem. While traditional Amplitude implementations ingest event data directly, WNA allows organizations to keep their data in Snowflake while still leveraging Amplitude's analytical capabilities.

## Technical Implementation

### Data Model Creation Methods
1. **Direct Table Selection**: Map existing Snowflake tables to Amplitude data models
2. **SQL Query**: Use custom SQL to define data structure for Amplitude models
3. **Bulk Model Management**: Use YAML configuration files to create/update multiple models
4. **DBT Integration**: Annotate DBT models with `amplitude_meta` to automatically create Amplitude models

### Required Fields for Event Models
- Event ID
- Event time
- User ID
- Event type

### Bulk Model Management Configuration
```yaml
dataModels:
  - name: "model_name"
    type: "EVENT|EVENT_PROPERTIES|CURRENT_USER_PROPERTIES|etc."
    tableConfig:
      schema: "schema_name"
      table: "table_name"
    # OR
    sqlConfig:
      query: "SELECT * FROM..."
    requiredFields:
      # field mappings
    fieldMapping:
      # additional field mappings
```

### DBT Integration Annotation
```yaml
{{ config(
    amplitude_meta={
        "data_models": [{
            "type": "EVENT",
            "special_columns": {
                "event_time": "timestamp_column",
                "user_id": "user_id_column",
                "event_type": "event_type_column"
            }
        }]
    }
) }}
```

### Best Practices
- **Clustering Key Optimization**: Choose high-cardinality columns frequently used in filters
- **Schema Design**: Use star schema for simpler queries and better performance
- **Partitioning Strategies**: Partition data based on query patterns
- **Performance Considerations**: Limit joins, pre-aggregate data, and use appropriate data types