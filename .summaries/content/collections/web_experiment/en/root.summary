## Amplitude Web Experimentation

Amplitude Web Experimentation is a client-side A/B testing and experimentation platform that enables teams to run experiments on websites without requiring code changes. The platform provides a Visual Editor for creating experiments, sophisticated targeting capabilities, and comprehensive tracking of user interactions with experiment variants.

### Core Features and Use Cases

The platform supports multiple experiment types including A/B tests and multi-armed bandit experiments. Key capabilities include:

- **Visual Editor**: No-code experiment creation through DOM manipulation, allowing element changes, styling modifications, and HTML editing
- **Custom Code Actions**: JavaScript, CSS, and HTML injection for advanced customizations
- **URL Redirects**: Client-side redirects with query parameter retention and session history evaluation
- **Advanced Targeting**: Page-level and audience-level targeting with local and remote evaluation
- **Performance Optimization**: Dynamic script sizing, two-layer caching, and synchronous local evaluation

### Product Architecture and Relationships

The Web Experimentation system consists of several interconnected components:

**Pages** serve as the foundation, defining URL targeting rules that control where experiments can run. These use various matching operators (URL Matches, URL Contains, URL Starts With, URL Ends With, URL Matches Regex) to scope experiment execution to specific pages or URL patterns.

**Actions** define how variants modify the user experience, operating in three categories:
- Element changes (display, visibility, text, background, positioning)
- URL redirects with intelligent parameter handling
- Custom code injection with utility functions like `waitForElement` and cleanup mechanisms

**Targeting** operates on two levels: page targeting (evaluated locally) and audience targeting (which may require remote evaluation for user properties). The system uses browser properties for immediate local evaluation and integrates with Amplitude's user data for behavioral targeting.

**Tracking** captures experiment exposure through impression events, transforming internal `$impression` events into `[Experiment] Impression` events with flag_key and variant properties for analysis.

### Key Nomenclature and Definitions

- **Flag Key**: Unique identifier for each experiment used in tracking and variant assignment
- **Variant**: Different versions of the experience being tested, including control and treatment variations
- **Bucketing**: Algorithm that assigns users to variants based on Device ID and rollout percentages
- **Anti-flicker**: Overlay mechanism that prevents content flash during experiment evaluation
- **Impression Events**: Tracking events fired when users are exposed to experiment variants
- **Page Targeting Rules**: URL matching conditions that determine experiment scope
- **Audience Targeting**: User segmentation based on properties, behaviors, or cohorts
- **Visual Editor**: No-code interface for creating DOM-based experiment variants
- **Custom Code Actions**: JavaScript/CSS/HTML injection capabilities for advanced modifications
- **IntegrationPlugin**: Interface for third-party CDP integrations

### Ecosystem Integration

Web Experimentation integrates deeply with the broader Amplitude ecosystem and external platforms:

**Amplitude Integration**: Leverages Amplitude's user identification, behavioral data, and analytics infrastructure. Uses Device ID and Amplitude ID for user bucketing and can target based on user properties and behavioral cohorts.

**Third-party CDP Integration**: Supports integration with customer data platforms through:
- Segment integration via query parameters
- Tealium iQ integration
- Custom IntegrationPlugin interface for other CDPs

**CMS and Tag Manager Support**: Provides specific implementation guidance for:
- WordPress through dedicated plugins
- Shopify App integration
- Google Tag Manager custom HTML tags

**Browser SDK Integration**: Can work alongside Amplitude's Browser SDK for enhanced tracking and user identification.

### Technical Implementation

**Script Installation**: Available through CDN endpoints for US (`cdn.amplitude.com`) and EU data centers, with both synchronous and asynchronous loading options. Includes anti-flicker snippets to prevent content flash.

**Performance Characteristics**: 
- Base script size of 79KB plus ~1KB per active flag
- Two-layer caching (CDN and browser) with 60-second max-age
- Synchronous local evaluation under 1ms
- Dynamic sizing based on active experiments

**Security Requirements**: Requires Content Security Policy configuration with `script-src` allowlisting and `Cross-Origin-Opener-Policy: unsafe-none` for proper operation.

**API and Utilities**: Provides utility functions like `waitForElement` for DOM readiness and `utils.remove` for cleanup in single-page applications.

### Post-Experiment Workflow

The platform emphasizes a migration-based approach where winning variants are implemented in production code rather than running experiments at 100% traffic allocation. This reduces technical debt, improves performance, and eliminates ongoing impression volume costs while maintaining the ability to rollback through feature flag controls.