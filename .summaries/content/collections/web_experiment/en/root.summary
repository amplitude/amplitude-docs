# Amplitude Web Experiment

## Product Overview

Amplitude Web Experiment is a visual A/B testing solution that enables non-technical users to create and run experiments on websites without requiring coding skills. The product allows users to visually modify website elements, create variants, target specific pages and audiences, and analyze results through Amplitude's analytics platform.

Key features include:
- Visual Editor for creating website variants without code
- Element manipulation (display, visibility, text, background, positioning)
- URL redirects for testing entirely different pages
- Custom code injection (JavaScript, HTML, CSS)
- Page and audience targeting capabilities
- Performance optimization with minimal impact on site speed
- Integration with Amplitude's analytics for experiment analysis

## Product Architecture and Relationships

Web Experiment consists of several interconnected components:

1. **Implementation Script**: A lightweight JavaScript file (20KB compressed) added to the website's `<head>` element that handles experiment loading, variant assignment, and impression tracking.

2. **Visual Editor**: A WYSIWYG interface that allows users to create variants by selecting and modifying page elements without coding.

3. **Targeting System**: Evaluates page targeting (URL patterns) and audience targeting (user properties) to determine experiment eligibility.

4. **Impression Tracking**: Automatically sends impression events to Amplitude for analysis and billing purposes.

5. **Anti-flicker Mechanism**: Prevents page flicker during experiment loading by hiding content until variants are applied.

The Web Experiment script works by evaluating targeting conditions locally in the browser, applying the appropriate variant modifications to the page, and tracking impressions back to Amplitude. The product is designed to have minimal performance impact with efficient caching mechanisms and local evaluation.

## Key Nomenclature and Definitions

- **Variant**: A modified version of a webpage created for testing against the original (control) version.
- **Element Changes**: Modifications to page elements including display, visibility, text, background, and positioning.
- **Impression Event**: An event sent to Amplitude when a user views an experiment variant, transformed during ingestion from `$impression` to `[Experiment] Impression`.
- **Anti-flicker Snippet**: Code that prevents the original page content from displaying before experiment variants are applied.
- **Page Targeting**: Rules that determine which URLs an experiment will run on, using matching operators.
- **Audience Targeting**: Rules that determine which users will participate in an experiment based on browser or user properties.
- **Bucketing**: The process of consistently assigning users to specific variants based on their Device ID.
- **waitForElement Utility**: A JavaScript function that waits for specific elements to appear on the page before applying changes.

## Integration with Amplitude Ecosystem

Web Experiment is tightly integrated with the broader Amplitude product ecosystem:

1. **Amplitude Analytics**: Experiment results are analyzed through Amplitude Analytics, with impression events automatically tracked and transformed for analysis.

2. **Amplitude Experiment**: Web Experiment is part of the Amplitude Experiment suite, which includes server-side experimentation capabilities. Web Experiment focuses specifically on client-side, visual website testing.

3. **User Properties**: Web Experiment sets user properties in Amplitude for each experiment a user is exposed to, enabling cohort analysis.

4. **Third-party CDPs**: The product can integrate with platforms like Segment and Tealium for deployment and data collection.

## Technical Implementation

### Script Implementation

```html
<!-- Synchronous implementation -->
<script src="https://cdn.experiment.amplitude.com/web-experiment.js"></script>

<!-- Asynchronous implementation with anti-flicker -->
<script>
  !function(){var e=document.createElement("style");e.textContent=":root{opacity:0;transition:opacity 0.5s;}";document.head.appendChild(e);var t=document.createElement("script");t.src="https://cdn.experiment.amplitude.com/web-experiment.js",t.onload=function(){document.documentElement.style.opacity="1"},document.head.appendChild(t)}();
</script>
```

### Integration with Third-party CDPs

```javascript
// Segment integration
analytics.ready(function() {
  var amplitudeExperiment = window.amplitudeExperiment;
  if (amplitudeExperiment) {
    amplitudeExperiment.setUserProperty = function(key, value) {
      analytics.setUserProperties({[key]: value});
    };
    amplitudeExperiment.track = function(eventName, eventProperties) {
      analytics.track(eventName, eventProperties);
    };
  }
});
```

### Custom Code Actions Example

```javascript
// JavaScript action example
function addModal() {
  const modal = document.createElement('div');
  modal.innerHTML = `
    <div style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); display: flex; justify-content: center; align-items: center; z-index: 9999;">
      <div style="background: white; padding: 20px; border-radius: 5px; max-width: 500px;">
        <h2>Special Offer!</h2>
        <p>Get 20% off your first purchase with code: WELCOME20</p>
        <button onclick="this.parentNode.parentNode.remove()">Close</button>
      </div>
    </div>
  `;
  document.body.appendChild(modal);
}
addModal();
```

## Post-Experiment Workflow

After an experiment reaches statistical significance, the recommended workflow is:

1. Document experiment results and learnings
2. Implement winning variants in production code
3. Deactivate the experiment in Amplitude
4. Remove the experiment from the codebase if no longer needed

This approach reduces technical debt, minimizes performance overhead, and optimizes impression volume costs compared to keeping experiments running at 100% allocation indefinitely.

## Performance Considerations

- Base script size: 20KB compressed
- Additional size per flag: ~100B
- Caching: CDN caching with cache-control headers (max-age=600, stale-while-revalidate=600)
- Browser caching: Enabled for script and experiment configurations
- Local evaluation performance: <1ms for typical experiments
- Limitations: Ad blockers may prevent experiment participation

## Impression Tracking and Billing

Impression events are tracked automatically and used for both analysis and billing. The formula to estimate monthly impression volume is:

```
Monthly Impressions = (Monthly Unique Users) × (Average Page Views per User) × (Number of Experiments)
```

These events are transformed during ingestion from `$impression` to `[Experiment] Impression` with properties including `flag_key`, `variant`, and `experiment_key`.