# Amplitude Web Experiment

## Overview

Amplitude Web Experiment is a visual A/B testing solution that enables non-technical users to create and run experiments on websites without coding skills. The product allows users to visually modify website elements, create variants, target specific audiences, and analyze results through Amplitude's analytics platform.

Key features include:
- Visual Editor for creating website variants without code
- Element manipulation (display, visibility, text, background, positioning)
- URL redirects for testing different pages
- Custom code injection (JavaScript, HTML, CSS)
- Page and audience targeting
- Performance optimization with minimal site speed impact
- Integration with Amplitude's analytics for experiment analysis

## Product Architecture and Relationships

Web Experiment consists of several interconnected components:

1. **Implementation Script**: A lightweight JavaScript file (20KB compressed) added to the website's `<head>` element that handles experiment loading, variant assignment, and impression tracking.

2. **Visual Editor**: A WYSIWYG interface for creating variants by selecting and modifying page elements without coding.

3. **Targeting System**: Evaluates page targeting (URL patterns) and audience targeting (user properties) to determine experiment eligibility.

4. **Impression Tracking**: Automatically sends impression events to Amplitude for analysis and billing.

5. **Anti-flicker Mechanism**: Prevents page flicker during experiment loading by hiding content until variants are applied.

The script evaluates targeting conditions locally in the browser, applies variant modifications to the page, and tracks impressions back to Amplitude, all with minimal performance impact.

## Key Nomenclature and Definitions

- **Variant**: A modified version of a webpage created for testing against the original (control) version.
- **Element Changes**: Modifications to page elements including display, visibility, text, background, and positioning.
- **Impression Event**: An event sent to Amplitude when a user views an experiment variant, transformed during ingestion from `$impression` to `[Experiment] Impression`.
- **Anti-flicker Snippet**: Code that prevents the original page content from displaying before experiment variants are applied.
- **Page Targeting**: Rules that determine which URLs an experiment will run on, using matching operators.
- **Audience Targeting**: Rules that determine which users will participate in an experiment based on browser or user properties.
- **Bucketing**: The process of consistently assigning users to specific variants based on their Device ID.
- **waitForElement Utility**: A JavaScript function that waits for specific elements to appear on the page before applying changes.

## Integration with Amplitude Ecosystem

Web Experiment is tightly integrated with the broader Amplitude product ecosystem:

1. **Amplitude Analytics**: Experiment results are analyzed through Amplitude Analytics, with impression events automatically tracked and transformed.

2. **Amplitude Experiment**: Web Experiment is part of the Amplitude Experiment suite, which includes server-side experimentation capabilities. Web Experiment focuses specifically on client-side, visual website testing.

3. **User Properties**: Web Experiment sets user properties in Amplitude for each experiment a user is exposed to, enabling cohort analysis.

4. **Third-party CDPs**: The product can integrate with platforms like Segment and Tealium for deployment and data collection.

## Technical Implementation

### Script Implementation

```html
<!-- Synchronous implementation -->
<script src="https://cdn.experiment.amplitude.com/web-experiment.js"></script>

<!-- Asynchronous implementation with anti-flicker -->
<script>
  !function(){var e=document.createElement("style");e.textContent=":root{opacity:0;transition:opacity 0.5s;}";document.head.appendChild(e);var t=document.createElement("script");t.src="https://cdn.experiment.amplitude.com/web-experiment.js",t.onload=function(){document.documentElement.style.opacity="1"},document.head.appendChild(t)}();
</script>
```

### Integration with Third-party CDPs

```javascript
// Segment integration
analytics.ready(function() {
  var amplitudeExperiment = window.amplitudeExperiment;
  if (amplitudeExperiment) {
    amplitudeExperiment.setUserProperty = function(key, value) {
      analytics.setUserProperties({[key]: value});
    };
    amplitudeExperiment.track = function(eventName, eventProperties) {
      analytics.track(eventName, eventProperties);
    };
  }
});
```

### Custom Code Actions Example

```javascript
// JavaScript action example
function addModal() {
  const modal = document.createElement('div');
  modal.innerHTML = `
    <div style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); display: flex; justify-content: center; align-items: center; z-index: 9999;">
      <div style="background: white; padding: 20px; border-radius: 5px; max-width: 500px;">
        <h2>Special Offer!</h2>
        <p>Get 20% off your first purchase with code: WELCOME20</p>
        <button onclick="this.parentNode.parentNode.remove()">Close</button>
      </div>
    </div>
  `;
  document.body.appendChild(modal);
}
addModal();
```

Performance considerations include a base script size of 20KB compressed, CDN caching with cache-control headers, and local evaluation performance of <1ms for typical experiments. Impression events are tracked automatically and used for both analysis and billing, with a formula to estimate monthly impression volume: Monthly Impressions = (Monthly Unique Users) × (Average Page Views per User) × (Number of Experiments).